var mt=Object.defineProperty;var ct=(i,o,n)=>o in i?mt(i,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):i[o]=n;var p=(i,o,n)=>ct(i,typeof o!="symbol"?o+"":o,n);(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))s(h);new MutationObserver(h=>{for(const l of h)if(l.type==="childList")for(const w of l.addedNodes)w.tagName==="LINK"&&w.rel==="modulepreload"&&s(w)}).observe(document,{childList:!0,subtree:!0});function n(h){const l={};return h.integrity&&(l.integrity=h.integrity),h.referrerPolicy&&(l.referrerPolicy=h.referrerPolicy),h.crossOrigin==="use-credentials"?l.credentials="include":h.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function s(h){if(h.ep)return;h.ep=!0;const l=n(h);fetch(h.href,l)}})();class t{constructor(o,n){p(this,"x");p(this,"y");this.x=o,this.y=n}distanceBetween(o){return Math.sqrt((this.x-o.x)**2+(this.y-o.y)**2)}angle(o){const n=this.x-o.x,s=this.y-o.y;return Math.atan(s/n)}add(o){return new t(this.x+o.x,this.y+o.y)}pointDifference(o){return new t(this.x-o.x,this.y-o.y)}}const M={positionRight:[{width:55,height:96,position:new t(5,0)},{width:86,height:88,position:new t(4,122)},{width:85,height:88,position:new t(104,123)},{width:84,height:90,position:new t(201,121)},{width:85,height:89,position:new t(302,122)},{width:84,height:88,position:new t(400,123)},{width:84,height:90,position:new t(500,121)}],positionLeft:[{width:55,height:96,position:new t(533,219)},{width:86,height:88,position:new t(503,341)},{width:85,height:88,position:new t(404,342)},{width:84,height:90,position:new t(308,340)},{width:85,height:89,position:new t(206,341)},{width:84,height:88,position:new t(109,342)},{width:84,height:90,position:new t(9,340)}]},Wi="/LF-SE-Minor-Project_Dungeon-Dread/assets/amaterasu-BhcJas4O.mp3",d={ingame:!1,aboutScreenFlag:!1,controlScreenFlag:!1,homeScreenFlag:!1,btnPressed:{},wave:5,buyScreenFlag:!1,ismute:!1,firstPageFlag:!1,assetsLoaded:0,loadingScreen:!1,infoScreenFlag:!1};function S(){d.assetsLoaded++}const yt="/LF-SE-Minor-Project_Dungeon-Dread/assets/amaterasu-Bq5RU4UD.png",ft="/LF-SE-Minor-Project_Dungeon-Dread/assets/hero-bHENNDIt.png",ut="/LF-SE-Minor-Project_Dungeon-Dread/assets/sharingan-CjDJlJ4A.png",Ji=new Image;Ji.src=ut;const Si=new Image,Pi=new Image;Si.src=yt;Pi.src=ft;const ji=new Audio(Wi),Qi=new Audio(Wi);Qi.onload=S;Si.onload=S;Pi.onload=S;ji.onload=S;const f={heroTotalHealth:200,width:M.positionLeft[0].width*window.innerHeight/1200,height:M.positionLeft[0].height*window.innerHeight/1200,velocity:new t(5,5),abilityDamage:.1,abilityRate:10,abilityDurability:10*1e3,maxEssence:50,amaterasuSound:Qi,heavyBreath:ji,stamina:10,image:Pi,amatherasuImage:Si,sharingan:Ji},St="/LF-SE-Minor-Project_Dungeon-Dread/assets/stoneandDrum-BzVPJaqp.svg",Pt="/LF-SE-Minor-Project_Dungeon-Dread/assets/bush-fjx7lCik.png",vt="/LF-SE-Minor-Project_Dungeon-Dread/assets/map-BCq2fiXg.png",vi=new Image;vi.src=vt;vi.onload=S;const Ii=new Image;Ii.src=Pt;Ii.onload=S;const bi=new Image;bi.src=St;bi.onload=S;let It=[];const ki=50,bt=Math.floor(window.innerWidth*10/ki),kt=Math.floor(window.innerHeight*10/ki),xt="#radial-gradient(#a9c0a6,#000)",g={tileSize:ki,mapWidth:bt,mapHeight:kt,mapColor:xt,mapTileArray:It,displayPosition:new t(0,0),mapSizeMultiplier:5,bushImage:Ii,stoneImage:bi,mapImage:vi},Tt="/LF-SE-Minor-Project_Dungeon-Dread/assets/homeMusic-CTRQ4BfC.mp3",Et="/LF-SE-Minor-Project_Dungeon-Dread/assets/wind-1mG3RRHB.mp3",Dt="/LF-SE-Minor-Project_Dungeon-Dread/assets/coinCollect-D0EQSH2R.wav",At="/LF-SE-Minor-Project_Dungeon-Dread/assets/deny-zoSqCo59.mp3",Ot="/LF-SE-Minor-Project_Dungeon-Dread/assets/gem-CYeD5NUz.png",xi=new Image;xi.src=Ot;xi.onload=S;const Ti=new Audio(Tt),Ei=new Audio(Et),Di=new Audio(Dt),Ai=new Audio(At);Ti.onload=S;Ei.onload=S;Di.onload=S;Ai.onload=S;Ti.volume=.5;Ei.volume=.5;Di.volume=.2;Ai.volume=.5;const e={collideableObjs:[],heroTotalHealth:120,waveIntervalTime:90*1e3,buyTime:30*1e3,maxEnemies:100*g.mapSizeMultiplier,mapPosition:new t(0,0),dropdownInterval:null,weaponArray:[null,null,null,null,null,null],homeSound:Ti,windSound:Ei,gemSound:Di,denySound:Ai,gemImage:xi},L={bulletSize:2,bulletVelocity:20,pestol:300,pestolFireRate:1,pestolDamage:5},ii={width:115,height:62,position:new t(27,18)},D={drum:{width:738,height:226,position:new t(590,2280)},stone:{width:1663,height:1487,position:new t(577,773)}};class ti{constructor(o,n,s,h){p(this,"position");p(this,"tileType");p(this,"isObstacle");p(this,"tileSize");this.position=o,this.tileType=n,this.isObstacle=s,this.tileSize=h}draw(o){switch(this.tileType){case"bush":o.drawImage(g.bushImage,ii.position.x,ii.position.y,ii.width,ii.height,this.position.x,this.position.y,this.tileSize,this.tileSize);break;case"empty":break;case"stone":o.drawImage(g.stoneImage,D.stone.position.x,D.stone.position.y,D.stone.width,D.stone.height,this.position.x,this.position.y,D.stone.width/30,D.stone.height/30);break;case"drum":o.drawImage(g.stoneImage,D.drum.position.x,D.drum.position.y,D.drum.width,D.drum.height,this.position.x,this.position.y,this.tileSize,this.tileSize);break}}}function T(i,o){const n=Math.ceil(i),s=Math.floor(o);return Math.floor(Math.random()*(s-n+1)+n)}class Rt{constructor(o){p(this,"tileSize");p(this,"mapHeight");p(this,"mapWidth");this.tileSize=o,this.mapHeight=Math.floor(window.innerHeight*g.mapSizeMultiplier/o),this.mapWidth=Math.floor(window.innerWidth*g.mapSizeMultiplier/o),this.initialize(),this.collectCollideableobj()}collectCollideableobj(){g.mapTileArray.forEach(o=>{o.forEach(n=>{n.isObstacle&&e.collideableObjs.push(n)})})}initialize(){for(let o=0;o<this.mapHeight;o++){g.mapTileArray[o]=[];for(let n=0;n<this.mapWidth;n++)if(n===0||o===0||o===this.mapHeight-1||n===this.mapWidth-1)g.mapTileArray[o][n]=new ti(new t(n*this.tileSize,o*this.tileSize),"bush",!0,this.tileSize);else{const s=T(1,100);s%2==0&&s<10?s>5?g.mapTileArray[o][n]=new ti(new t(n*this.tileSize,o*this.tileSize),"drum",!0,this.tileSize):g.mapTileArray[o][n]=new ti(new t(n*this.tileSize,o*this.tileSize),"stone",!0,this.tileSize):g.mapTileArray[o][n]=new ti(new t(n*this.tileSize,o*this.tileSize),"empty",!1,this.tileSize)}}}draw(o){g.mapTileArray.forEach(n=>{n.forEach(s=>{s.draw(o)})})}}class j{constructor(o,n,s,h,l,w,u=0,x=0,k=new Image,O=0,z=new t(5,5)){p(this,"position");p(this,"team");p(this,"lookingLeft");p(this,"healthpoint");p(this,"width");p(this,"height");p(this,"spritePosition",0);p(this,"velocity");p(this,"damage");p(this,"attackRate");p(this,"gruntImage");p(this,"gruntType");this.position=o,this.team=n,this.lookingLeft=s,this.healthpoint=h,this.width=l,this.height=w,this.damage=u,this.attackRate=x,this.gruntImage=k,this.gruntType=O,this.velocity=z}}const q={width:339,height:404,position:[new t(6,13),new t(345,13),new t(684,13),new t(1024,13),new t(1365,13),new t(1706,13),new t(2047,13),new t(2388,13)]};class Mt extends j{constructor(){super(...arguments);p(this,"isMoving",!1);p(this,"speedLimit",3);p(this,"weaponOffset",10);p(this,"abilityInterval",null);p(this,"abilityDamage",f.abilityDamage);p(this,"abilityDurability",f.abilityDurability);p(this,"abilityRate",f.abilityRate);p(this,"abilityInUse",!1);p(this,"inRangeEnemies",[]);p(this,"abilityTime",new Date);p(this,"stamina",f.stamina);p(this,"staminaInterval");p(this,"healthInterval");p(this,"staminaUse",!1);p(this,"gemCount",0);p(this,"essenceCount",0);p(this,"weaponPositions",[new t(this.position.x+this.weaponOffset+this.width,this.position.y),new t(this.position.x-this.weaponOffset,this.position.y),new t(this.position.x+this.weaponOffset+this.width,this.position.y+this.height/2),new t(this.position.x-this.weaponOffset,this.position.y+this.height/2),new t(this.position.x+this.weaponOffset+this.width,this.position.y),new t(this.position.x+this.weaponOffset+this.width,this.position.y)])}ability(){!this.abilityInUse&&new Date().getTime()-this.abilityTime.getTime()>15*1e3&&this.essenceCount&&(this.abilityInUse=!0,f.amaterasuSound.currentTime=2,f.amaterasuSound.play(),this.inRangeEnemies=b.filter(n=>{if(n.position.x>-e.mapPosition.x&&n.position.x<-e.mapPosition.x+a.width&&n.position.y>-e.mapPosition.y&&n.position.y<-e.mapPosition.y+a.height)return!0}),v&&this.inRangeEnemies.push(v),setTimeout(()=>{this.inRangeEnemies=[],this.abilityInUse=!1},this.abilityDurability*(this.essenceCount/f.maxEssence)),this.abilityTime=new Date,this.essenceCount=0)}reheal(){this.healthInterval=setInterval(()=>{this.healthpoint<50&&(f.heavyBreath.played||f.heavyBreath.play(),this.healthpoint+=3)},5e3),this.staminaInterval=setInterval(()=>{this.stamina<f.stamina&&(this.stamina+=1),this.staminaUse=!1},2e3)}run(){this.staminaUse=!0,this.stamina>0&&(this.velocity=new t(7,7),this.stamina-=.1)}checkCollision(){let n=!1,s=e.collideableObjs[0];return e.collideableObjs.forEach(h=>{h.position.y+h.tileSize>=this.position.y&&h.position.y<=this.position.y+this.height&&h.position.x+h.tileSize>=this.position.x&&h.position.x+h.tileSize<=this.position.x+h.tileSize+this.width&&(n=!0,s=h)}),{collided:n,collidedObj:s}}updateWeaponPosition(){this.weaponPositions=[new t(this.position.x+this.weaponOffset+this.width,this.position.y),new t(this.position.x-this.weaponOffset,this.position.y),new t(this.position.x+this.weaponOffset+this.width,this.position.y+this.height/2),new t(this.position.x-this.weaponOffset,this.position.y+this.height/2),new t(this.position.x+this.weaponOffset+this.width,this.position.y+this.height),new t(this.position.x-this.weaponOffset,this.position.y+this.height)]}moveLeft(n,s){const h=n?this.velocity.x:-1*this.velocity.x;this.lookingLeft=n;const l=this.checkCollision();if(!l.collided)e.mapPosition.x+=h,s.translate(h,0);else{const w=l.collidedObj.position.y<this.position.y?-1:1,u=l.collidedObj.position.x<this.position.x?-1:1;e.mapPosition.x+=u,e.mapPosition.y+=w,s.translate(u,w)}}moveUp(n,s){const h=n?this.velocity.y:-1*this.velocity.y,l=this.checkCollision();if(!l.collided)e.mapPosition.y+=h,s.translate(0,h);else{const w=l.collidedObj.position.y<this.position.y?-1:1,u=l.collidedObj.position.x<this.position.x?-1:1;e.mapPosition.x+=u,e.mapPosition.y+=w,s.translate(u,w)}}draw(n){this.updateWeaponPosition(),this.position.x=a.width/2-e.mapPosition.x,this.position.y=a.height/2-e.mapPosition.y,this.inRangeEnemies.forEach(h=>{let l=Math.floor(this.spritePosition/5)%q.position.length;n.drawImage(f.amatherasuImage,q.position[l].x,q.position[l].y,q.width,q.height,h.position.x,h.position.y,h.width,h.height),h.healthpoint-=this.abilityDamage});const s=this.lookingLeft?M.positionLeft:M.positionRight;if(this.isMoving){const h=20/this.velocity.x*.9;let l=Math.floor(this.spritePosition/h)%(s.length-1)+1;this.width=M.positionLeft[l].width*window.innerHeight/1200,this.height=M.positionLeft[l].height*window.innerHeight/1200,n.drawImage(f.image,s[l].position.x,s[l].position.y,s[l].width,s[l].height,this.position.x,this.position.y,this.width,this.height)}else this.width=M.positionLeft[0].width*window.innerHeight/1200,this.height=M.positionLeft[0].height*window.innerHeight/1200,n.drawImage(f.image,s[0].position.x,s[0].position.y,s[0].width,s[0].height,this.position.x,this.position.y,this.width,this.height);this.spritePosition++}}const I={width:31,height:17,position:[new t(76,17),new t(224,17),new t(410,17),new t(576,17),new t(742,17),new t(76,118),new t(224,118),new t(410,118),new t(576,118),new t(742,118),new t(48,217)]},ni={width:24,height:34,positionLeft:[new t(10,3),new t(118,3),new t(226,3),new t(335,3),new t(443,3),new t(6,114),new t(443,3),new t(335,3),new t(226,3),new t(118,3)],positionRight:[new t(479,2),new t(587,2),new t(696,3),new t(804,5),new t(914,5),new t(482,112),new t(914,5),new t(804,5),new t(696,3),new t(587,2)]},U={width:34,height:30,positionRight:[new t(84,542),new t(121,541),new t(158,542),new t(195,541)],positionLeft:[new t(343,541),new t(308,542),new t(269,541),new t(232,542)]},Lt="/LF-SE-Minor-Project_Dungeon-Dread/assets/type_3_4_-0Cq7KuU3.png",Ft="/LF-SE-Minor-Project_Dungeon-Dread/assets/type1-CCCx1Bt1.png",Ht="/LF-SE-Minor-Project_Dungeon-Dread/assets/type2-BH0ylXV7.png",zt="/LF-SE-Minor-Project_Dungeon-Dread/assets/bossLeft-CV5mu1oo.png",Ct="/LF-SE-Minor-Project_Dungeon-Dread/assets/bossRight-CcEZmngP.png",Bt="/LF-SE-Minor-Project_Dungeon-Dread/assets/spwan-6_Ug9n4C.png",Oi=new Image;Oi.src=Bt;const Ri=new Image,V=new Image,Mi=new Image;Ri.src=Ft;V.src=Lt;Mi.src=Ht;const Li=new Image;Li.src=zt;const Fi=new Image;Fi.src=Ct;Ri.onload=S;V.onload=S;Mi.onload=S;Li.onload=S;Oi.onload=S;Fi.onload=S;const m={type1:{healthPoint:10,width:ni.width*window.innerHeight/700,height:ni.height*window.innerHeight/700,image:Ri,attackRate:2,damage:2,velocity:new t(1,1)},type2:{healthPoint:20,width:window.innerHeight/1500,height:window.innerHeight/1500,image:Mi,attackRate:2,damage:2,velocity:new t(1,1)},type3:{healthPoint:15,width:U.width*window.innerHeight/700,height:U.height*window.innerHeight/700,image:V,attackRate:3,damage:6,velocity:new t(3,3)},type4:{healthPoint:28,width:window.innerHeight/500,height:window.innerHeight/500,image:V,attackRate:1,damage:3,velocity:new t(1,1)},boss:{healthPoint:800,width:window.innerHeight/500,height:window.innerHeight/500,image:V,attackRate:1,damage:30,velocity:new t(1,1),velocityFast:new t(4,4),imageLeft:Li,imageRight:Fi},spwanImage:Oi};class _i extends j{constructor(){super(...arguments);p(this,"isSpwaned",!1);p(this,"attackInterval",null)}checkCollision(){let n=!1,s=!1,h=e.collideableObjs[0];return e.collideableObjs.forEach(l=>{l.position.y+l.tileSize>=this.position.y&&l.position.y<=this.position.y+this.height&&l.position.x+l.tileSize>=this.position.x&&l.position.x+l.tileSize<=this.position.x+l.tileSize+this.width&&(n=!0,h=l)}),r.position.y+r.height/2>=this.position.y&&r.position.y<=this.position.y+this.height&&r.position.x+r.width>=this.position.x&&r.position.x+r.width<=this.position.x+r.width+this.width?(s=!0,h=r,this.attackInterval||(this.attackInterval=setInterval(()=>{r.healthpoint>0&&(r.healthpoint-=this.damage)},1e3/this.attackRate))):(clearInterval(this.attackInterval),this.attackInterval=null),{collided:n,collidedObj:h,collidedHero:s}}update(){const n=this.checkCollision();this.lookingLeft=this.position.x>r.position.x;const s=Math.sqrt((this.position.x-r.position.x)**2+(this.position.y-r.position.y)**2);s>50&&(clearInterval(this.attackInterval),this.attackInterval=null);const h=new t((this.position.x-r.position.x)/s,(this.position.y-r.position.y)/s),l=Math.sqrt(this.velocity.x*this.velocity.x+this.velocity.y*this.velocity.y),w=new t(-h.x*l,-h.y*l);if(!n.collidedHero&&!n.collided&&(this.position.x+=w.x,this.position.y+=w.y),n.collided){const u=n.collidedObj.position.x<this.position.x?1:-1,x=n.collidedObj.position.y<this.position.y?1:-1;this.position.x+=u,this.position.y+=x}}draw(n){if(this.isSpwaned){let s;switch(this.gruntType){case 1:s=ni;break;case 3:s=U;break}const h=this.lookingLeft?s.positionLeft:s.positionRight;this.update();let w=Math.floor(this.spritePosition/5)%s.positionLeft.length;n.drawImage(this.gruntImage,h[w].x,h[w].y,U.width,U.height,this.position.x,this.position.y,this.width,this.height),this.spritePosition++}}spwan(n){let h=Math.floor(this.spritePosition/10)%I.position.length;n.drawImage(m.spwanImage,I.position[h].x,I.position[h].y,I.width,I.height,this.position.x,this.position.y,this.width,this.height),this.spritePosition++,h>=9&&(this.isSpwaned=!0,this.spritePosition=0)}}const A={width:45,height:55,positionRight:[new t(93,226),new t(142,230),new t(189,235),new t(229,231)],positionLeft:[new t(278,235),new t(326,231),new t(372,225),new t(414,230)],attackLeft:[{width:34,height:58,position:new t(173,283)},{width:64,height:41,position:new t(208,300)},{width:53,height:42,position:new t(273,305)}],attackRight:[{width:33,height:58,position:new t(20,283)},{width:64,height:41,position:new t(54,300)},{width:53,height:41,position:new t(119,306)}]};class Gt extends j{constructor(){super(...arguments);p(this,"isSpwaned",!1);p(this,"attackInterval",null);p(this,"isAttacking",!1)}checkCollision(){let n=!1,s=!1,h=e.collideableObjs[0];return e.collideableObjs.forEach(l=>{l.position.y+l.tileSize>=this.position.y&&l.position.y<=this.position.y+this.height&&l.position.x+l.tileSize>=this.position.x&&l.position.x+l.tileSize<=this.position.x+l.tileSize+this.width&&(n=!0,h=l)}),r.position.y+r.height/2>=this.position.y&&r.position.y<=this.position.y+this.height&&r.position.x+r.width>=this.position.x&&r.position.x+r.width<=this.position.x+r.width+this.width&&(s=!0,h=r),{collided:n,collidedObj:h,collidedHero:s}}update(){const n=this.checkCollision();this.lookingLeft=this.position.x>r.position.x;const s=Math.sqrt((this.position.x-r.position.x)**2+(this.position.y-r.position.y)**2);s>50&&(clearInterval(this.attackInterval),this.attackInterval=null);const h=new t((this.position.x-r.position.x)/s,(this.position.y-r.position.y)/s),l=Math.sqrt(2);if(this.velocity=new t(-h.x*l,-h.y*l),n.collidedHero?this.isAttacking=!0:(this.position.x+=this.velocity.x,this.position.y+=this.velocity.y,this.isAttacking=!1),!n.collided)this.position.x+=this.velocity.x,this.position.y+=this.velocity.y;else{const w=n.collidedObj.position.x<this.position.x?1:-1,u=n.collidedObj.position.y<this.position.y?1:-1;this.position.x+=w,this.position.y+=u}}draw(n){if(this.update(),this.isAttacking){const s=this.lookingLeft?A.attackLeft:A.attackRight,h=10,l=Math.floor(this.spritePosition/h)%A.attackLeft.length;this.height=s[l].height,this.width=s[l].width,l===2&&this.spritePosition%h===0&&(r.healthpoint-=this.damage),n.drawImage(m.type3.image,s[l].position.x,s[l].position.y,s[l].width,s[l].height,this.position.x,this.position.y,this.width,this.height)}else{const s=this.lookingLeft?A.positionLeft:A.positionRight,l=Math.floor(this.spritePosition/8)%A.positionLeft.length;this.width=A.width,this.height=A.height,n.drawImage(m.type3.image,s[l].x,s[l].y,A.width,A.height,this.position.x,this.position.y,this.width,this.height)}this.spritePosition++}spwan(n){const h=Math.floor(this.spritePosition/10)%I.position.length;n.drawImage(m.spwanImage,I.position[h].x,I.position[h].y,I.width,I.height,this.position.x,this.position.y,this.width,this.height),this.spritePosition++,h>=9&&(this.isSpwaned=!0,this.spritePosition=0)}}class Ki{constructor(o,n,s,h){p(this,"position");p(this,"damage");p(this,"isHit",!1);p(this,"velocity");p(this,"gunPosition");p(this,"radius",window.innerWidth/100);this.position=o,this.damage=n,this.velocity=s,this.gunPosition=h}checkOnhit(){this.position.x-this.radius>r.position.x&&this.position.x+this.radius<r.position.x+r.width&&this.position.y-this.radius>r.position.y&&this.position.y+this.radius<r.position.y+r.height&&(this.isHit=!0,r.healthpoint-=this.damage)}update(){this.position.x+=this.velocity.x,this.position.y+=this.velocity.y}draw(o){this.update(),o.beginPath(),o.fillStyle="green",o.arc(this.position.x,this.position.y,this.radius,0,Math.PI*2),o.fill()}}const _t={position:[{width:137,height:79,position:new t(12,28)},{width:144,height:78,position:new t(168,28)},{width:147,height:77,position:new t(326,29)},{width:144,height:76,position:new t(488,28)},{width:127,height:80,position:new t(659,27)},{width:111,height:83,position:new t(27,168)},{width:127,height:80,position:new t(179,167)}]};class Nt extends j{constructor(){super(...arguments);p(this,"isSpwaned",!1);p(this,"attackInterval",null);p(this,"attackRadius",400);p(this,"spitRange",200)}update(){const n=Math.sqrt((this.position.x-r.position.x)**2+(this.position.y-r.position.y)**2),s=new t((this.position.x-r.position.x)/n,(this.position.y-r.position.y)/n),h=Math.sqrt(this.velocity.x*this.velocity.x+this.velocity.y*this.velocity.y),l=new t(-s.x*h,-s.y*h);n>this.spitRange?(clearInterval(this.attackInterval),this.attackInterval=null,this.position.x+=l.x,this.position.y+=l.y):this.spitHero()}spitHero(){this.attackInterval||(this.attackInterval=setInterval(()=>{if(r){const n=new t(r.position.x,r.position.y),s=this.position.pointDifference(n),h=this.position.distanceBetween(n),l=new t(s.x/h,s.y/h),w=new Ki(new t(this.position.x+this.width/2,this.position.y+this.width/2),this.damage,new t(-l.x*L.bulletVelocity*.3,-l.y*L.bulletVelocity*.3),this.position);$.push(w)}},1e3/this.attackRate))}draw(n){const s=_t;this.update();let l=Math.floor(this.spritePosition/5)%s.position.length;this.width=s.position[l].width,this.height=s.position[l].height,n.drawImage(this.gruntImage,s.position[l].position.x,s.position[l].position.y,s.position[l].width,s.position[l].height,this.position.x,this.position.y,s.position[l].width*m.type2.width,s.position[l].height*m.type2.height),this.spritePosition++}spwan(n){let h=Math.floor(this.spritePosition/10)%I.position.length;n.drawImage(m.spwanImage,I.position[h].x,I.position[h].y,I.width,I.height,this.position.x,this.position.y,this.width,this.height),this.spritePosition++,h>=9&&(this.isSpwaned=!0,this.spritePosition=0)}}const y={1:[{width:80,height:80,position:new t(91,7)},{width:77,height:80,position:new t(172,7)},{width:57,height:80,position:new t(262,7)},{width:40,height:80,position:new t(351,7)},{width:57,height:80,position:new t(422,7)},{width:77,height:80,position:new t(492,7)}]};class $t{constructor(o,n,s,h){p(this,"position");p(this,"value");p(this,"spritePostion",0);p(this,"width");p(this,"height");this.position=o,this.value=n,this.width=s,this.height=h}draw(o){const s=Math.floor(this.spritePostion/5)%y[1].length;o.drawImage(e.gemImage,y[1][s].position.x,y[1][s].position.y,y[1][s].width,y[1][s].height,this.position.x,this.position.y,y[1][s].width*.3,y[1][s].height*.3),this.spritePostion++}collected(){return r.position.y+r.height+20>=this.position.y&&r.position.y-20<=this.position.y+this.height&&r.position.x+r.width+20>=this.position.x&&r.position.x-20<=this.position.x+this.width?(d.ismute||(e.gemSound&&(e.gemSound.pause(),e.gemSound.currentTime=0),e.gemSound.play()),r.gemCount+=this.value,r.essenceCount<f.maxEssence&&(r.essenceCount+=1),!1):!0}}function B(i,o,n,s,h,l,w="",u="2rem ShadowOfTheDead",x="#4caf50"){i.font=u,i.fillStyle=x,i.fillText(w,o.x,o.y-l/5);const k=Math.floor(n/s*h);i.strokeStyle="black",i.strokeRect(o.x,o.y,h,l),i.fillStyle="rgba(200,200,200,0.5)",i.fillRect(o.x,o.y,h,l),i.fillStyle="rgba(76, 175, 80,0.5)",i.fillRect(o.x,o.y,k,l)}const C={width:226,height:148,positionLeft:[new t(1,21),new t(234,21),new t(456,21),new t(700,21),new t(936,21),new t(1169,21),new t(1396,21),new t(1622,21),new t(1850,21),new t(2077,21),new t(2304,21),new t(2531,21),new t(2758,21),new t(2985,21),new t(3212,21),new t(3439,21),new t(3665,21),new t(3892,21),new t(4119,21),new t(4346,21),new t(4572,21),new t(4800,21),new t(5027,21),new t(5253,21),new t(5481,21),new t(5708,21),new t(5936,21),new t(6163,21),new t(6391,21),new t(6619,21),new t(6846,21),new t(7074,21),new t(7301,21),new t(7529,21),new t(7983,21),new t(8210,21),new t(8437,21),new t(8665,21)],positionRight:[new t(1,21),new t(229,21),new t(458,21),new t(686,21),new t(914,21),new t(1143,21),new t(1370,21),new t(1598,21),new t(1827,21),new t(2056,21),new t(2284,21),new t(2512,21),new t(2740,21),new t(2968,21),new t(3195,21),new t(3422,21),new t(3651,21),new t(3878,21),new t(4107,21),new t(4334,21),new t(4562,21),new t(4790,21),new t(5018,21),new t(5246,21),new t(5475,21),new t(5703,21),new t(5932,21),new t(6160,21),new t(6388,21),new t(6616,21),new t(6843,21),new t(7071,21),new t(7300,21),new t(7755,21),new t(7982,21),new t(8209,21),new t(8437,21),new t(8665,21)]};class qt extends j{constructor(){super(...arguments);p(this,"speedToggle",!1);p(this,"attackInterval",null);p(this,"spitInterval",null)}changeSpeed(){this.spitTohero(),this.spitInterval=setInterval(()=>{this.velocity=this.speedToggle?m.boss.velocity:m.boss.velocityFast,this.speedToggle=!this.speedToggle},5e3)}checkCollision(){return r.position.y+r.height/2>=this.position.y&&r.position.y<=this.position.y+this.height&&r.position.x+r.width>=this.position.x&&r.position.x+r.width<=this.position.x+r.width+this.width}update(){this.checkCollision()?this.attackInterval||(this.attackInterval=setInterval(()=>{r.healthpoint>0&&(r.healthpoint-=this.damage)},1e3/this.attackRate)):(this.moveTowardsHero(),clearInterval(this.attackInterval),this.attackInterval=null)}spitTohero(){this.attackInterval||(this.spitInterval=setInterval(()=>{if(r){const n=new t(r.position.x,r.position.y),s=this.position.pointDifference(n),h=this.position.distanceBetween(n),l=new t(s.x/h,s.y/h),w=new Ki(new t(this.position.x+this.width/2,this.position.y+this.width/2),this.damage,new t(-l.x*L.bulletVelocity*.3,-l.y*L.bulletVelocity*.3),this.position);$.push(w)}},1e3/this.attackRate))}moveTowardsHero(){const n=this.position.pointDifference(r.position),s=this.position.distanceBetween(r.position),h=new t(-(n.x/s)*this.velocity.x,-(n.y/s)*this.velocity.y);this.position.x+=h.x,this.position.y+=h.y}draw(n){this.update(),this.lookingLeft=r.position.x<this.position.x+this.width/2;const s=this.lookingLeft?C.positionLeft:C.positionRight,h=this.lookingLeft?m.boss.imageLeft:m.boss.imageRight;let w=Math.floor(this.spritePosition/5)%s.length;this.width=C.width*m.boss.width,this.height=C.height*m.boss.height,n.drawImage(h,s[w].x,s[w].y,C.width,C.height,this.position.x,this.position.y,this.width,this.height),B(n,this.position,this.healthpoint,m.boss.healthPoint,200,5),this.spritePosition++}}const E={width:66,height:38,positionRight:[new t(5,31),new t(67,40),new t(19,46)],positionLeft:[new t(90,31),new t(94,40),new t(143,46)]},G={width:66,height:38,positionLeft:[new t(5,31),new t(67,40),new t(19,46)],positionRight:[new t(90,31),new t(94,40),new t(143,46)]},Ut="/LF-SE-Minor-Project_Dungeon-Dread/assets/pestol-2UG2JAP-.svg",Vt="/LF-SE-Minor-Project_Dungeon-Dread/assets/smg-9gzp5Pqq.svg",oi="/LF-SE-Minor-Project_Dungeon-Dread/assets/gun-tiATYDmM.mp3",Hi=new Audio(oi),zi=new Image;zi.src=Ut;const Ci=new Image;Ci.src=Vt;Hi.onload=()=>{d.assetsLoaded++};zi.onload=S;Ci.onload=S;Hi.onload=S;const c={pistol:{damage:3,width:E.width*f.width*.01,height:E.height*f.width*.01,image:zi,fireRate:2,cost:500,soundSrc:oi},smg:{damage:1,width:G.width*f.width*.01,height:G.height*f.width*.01,image:Ci,fireRate:4,cost:1500,soundSrc:oi},sound:Hi};function ei(i,o,n=new t(-(i.measureText(o).width/2+e.mapPosition.x),a.height/2-e.mapPosition.y),s="5rem ShadowOfTheDeadOver",h="#4caf50"){i.font=s,i.fillStyle=h,i.translate(n.x,n.y),i.fillText(o,a.width/2,0),i.translate(-n.x,-n.y)}const Yt="/LF-SE-Minor-Project_Dungeon-Dread/assets/background-fPH3rH_v.webp",Xt="/LF-SE-Minor-Project_Dungeon-Dread/assets/Controls-B4QXboM1.png",Bi=new Image;Bi.src=Xt;Bi.onload=S;const Gi=new Image;Gi.src=Yt;Gi.onload=S;const Y={controlImage:Bi,backGroundImage:Gi};function _(i,o,n,s="3rem Eater",h="white"){return n||console.log("no position"),i.fillStyle=h,i.font=s,i.fillText(o,n.x,n.y),i.measureText(o)}function Wt(i,o,n,s,h="1rem Arial",l="white"){i.font=h,i.fillStyle=l;const w=i.measureText("sample"),u=w.actualBoundingBoxAscent+w.actualBoundingBoxDescent,x=o.split(" ").filter(F=>F.trim()!=="");let k="",O=s.y+u;const z=s.x+u;for(let F=0;F<x.length;F++){const Q=k+x[F]+" ",K=i.measureText(Q).width;k=Q,K>n*.9&&(i.fillText(k,z,O),O+=u,k="")}i.fillText(k,z,O)}function N(i,o,n){i=new t(i.x+e.mapPosition.x,i.y+e.mapPosition.y);const s=n.width,h=n.actualBoundingBoxAscent+n.actualBoundingBoxDescent;return i.x>o.x&&i.x<o.x+s&&i.y>o.y-h&&i.y<o.y}let Zi,si,it;function Jt(i,o){N(i,si,it)&&(d.infoScreenFlag=!1,Zi(o))}function jt(i,o,n,s){i.drawImage(Y.backGroundImage,0,0,a.width,a.height),i.fillStyle="rgba(40,40,40,0.8)",i.fillRect(a.width*.1,a.height*.1,a.width*.8,a.height*.8),i.fillStyle="white",i.font="2rem ShadowOfTheDeadOver",i.fillText(o,a.width*.1,a.height*.1),Wt(i,n,a.width*.8,new t(a.width*.1,a.height*.3),"1rem GloriaHallelujah"),si=new t(a.width*.1,a.height*.8),it=_(i,s,si,"1rem ShadowOfTheDeadOver")}function tt(i,o,n,s){i.clearRect(0,0,a.width,a.height),jt(i,o,n,s),requestAnimationFrame(()=>{tt(i,o,n,s)})}function Qt(i,o,n,s,h){Zi=h,d.infoScreenFlag=!0,i.translate(-e.mapPosition.x,-e.mapPosition.y),e.mapPosition=new t(0,0),tt(i,o,n,s)}const Ni={about:{heading:"About",msg:`The world in Dungeon Dread has multiple dungeons 
            where zombies/monsters exist. The dungeon boss controls them. 
            Our main character is a zombie/monster hunter. 
            Initially, our character is equipped with 
            a weaker weapon. As he kills zombies and collects 
            rewards, the character can buy weapons at the end 
            of the wave. The boss appears at the final wave. 
            The game's objective is to survive each wave and defeat 
            the boss. Boss is much stronger than a regular monster/zombie. Stronger in the sense 
            of higher damage and higher health. After defeating the boss, 
            the dungeon's remaining monsters/zombies disappear and the dungeon 
            is free of monsters/zombies.`},gameOver:{heading:"Game Over",msg:`
        You failed the mission. The villagers were attacked by the monsters`},gameWin:{heading:"You Win",msg:"You defended the village"}};function ai(i,o,n,s){Qt(i,Ni[o].heading,Ni[o].msg,n,s)}function et(i){var s;i.strokeStyle="white",i.fillStyle="rgba(40,200,40,0.1)",i.fillRect(-e.mapPosition.x+a.width*.2,-e.mapPosition.y+a.height*.8,a.width*.6,a.width*.08),i.strokeRect(-e.mapPosition.x+a.width*.2,-e.mapPosition.y+a.height*.8,a.width*.6,a.width*.08),i.font="1rem Arial";const n=10;for(let h=0;h<6;h++){if(e.weaponArray[h])switch((s=e.weaponArray[h])==null?void 0:s.level){case 1:i.fillStyle="rgba(200,200,200,0.8)";break;case 2:i.fillStyle="rgba(15,10,222,0.8)";break;case 3:i.fillStyle="rgba(255,215,0,0.8)";break}else i.fillStyle="rgba(200,200,200,1)";i.fillRect(-e.mapPosition.x+a.width*(.2+.1*h+.025),-e.mapPosition.y+a.height*(.8+.03),a.width*.05,a.width*.05),e.weaponArray[h]&&(i.drawImage(e.weaponArray[h].gunImage,-e.mapPosition.x+a.width*(.2+.1*h+.025),-e.mapPosition.y+a.height*(.8+.03),a.width*.05,a.width*.05),i.fillStyle="green",i.fillRect(-e.mapPosition.x+a.width*(.2+.1*h+.025),-e.mapPosition.y+a.height*(.8+.03),a.width*.01,a.width*.01),i.fillStyle="white",i.fillText(`${e.weaponArray[h].level}`,-e.mapPosition.x+a.width*(.2+.1*h+.025),-e.mapPosition.y+a.height*(.8+.03)+n))}}const H={1:[{width:5,height:5,position:new t(106,614)},{width:5,height:16,position:new t(114,614)},{width:10,height:30,position:new t(122,614)},{width:5,height:32,position:new t(135,614)},{width:10,height:30,position:new t(143,614)},{width:15,height:3,position:new t(160,614)},{width:19,height:5,position:new t(183,614)},{width:21,height:7,position:new t(207,614)},{width:22,height:9,position:new t(232,614)},{width:23,height:11,position:new t(256,614)},{width:24,height:13,position:new t(281,614)},{width:24,height:15,position:new t(306,614)},{width:24,height:16,position:new t(331,614)}]};let hi,nt;function Kt(i,o){N(i,hi,nt)&&(d.aboutScreenFlag=!1,X(o))}function Zt(i){i.drawImage(Y.backGroundImage,0,0,a.width,a.height),i.fillStyle="rgba(40,40,40,0.8)",i.drawImage(Y.controlImage,a.width*.1,a.height*.2,a.width*.5,a.height*.5),i.fillStyle="white",i.font="2rem ShadowOfTheDeadOver",i.fillText("Controls",a.width*.1,a.height*.1),hi=new t(a.width*.1,a.height*.8),nt=_(i,"<-- return Home",hi,"1rem ShadowOfTheDeadOver")}function ot(i){i.clearRect(0,0,a.width,a.height),Zt(i),requestAnimationFrame(()=>{ot(i)})}function ie(i){d.controlScreenFlag=!0,console.log("in control"),i.translate(-e.mapPosition.x,-e.mapPosition.y),e.mapPosition=new t(0,0),ot(i)}let li,ri,pi,di,wi,gi,$i=0;function te(i,o){i=new t(-e.mapPosition.x+i.x,-e.mapPosition.y+i.y),ri&&N(i,li,ri)&&(d.homeScreenFlag=!1,e.homeSound.pause(),rt(o)),gi&&N(i,wi,gi)&&(d.homeScreenFlag=!1,ie(o)),di&&N(i,pi,di)&&(d.homeScreenFlag=!1,ai(o,"about","<=return Home",X))}function ee(i){const o=Math.floor($i/8)%H[1].length;i.drawImage(m.type3.image,H[1][o].position.x,H[1][o].position.y,H[1][o].width,H[1][o].height,a.width*.9-24,e.mapPosition.y,H[1][o].width*a.width*.001,H[1][o].height*a.width*.001),$i++}function ne(i){i.clearRect(-e.mapPosition.x,-e.mapPosition.y,a.width,a.height),i.drawImage(Y.backGroundImage,-e.mapPosition.x,-e.mapPosition.y,a.width,a.height),i.fillStyle="rgba(40,40,40,0.1)",i.fillRect(-e.mapPosition.x,-e.mapPosition.y,a.width,a.height),li=new t(-e.mapPosition.x+a.width*.01,-e.mapPosition.y+a.height*.4),wi=new t(-e.mapPosition.x+a.width*.01,-e.mapPosition.y+a.height*.5),pi=new t(-e.mapPosition.x+a.width*.01,-e.mapPosition.y+a.height*.6);const o="DUNGEON DREAD";i.font="4rem ShadowOfTheDeadOver",i.fillStyle="white";const n=i.measureText(o);i.fillText(o,-e.mapPosition.x+a.width*.01,-e.mapPosition.y+a.height*.01+n.actualBoundingBoxAscent+n.actualBoundingBoxDescent),ri=_(i,"PLAY",li,"4rem bold Eater ","red"),di=_(i,"ABOUT",pi),gi=_(i,"INSTRUCTIONS",wi),ee(i)}function st(i){i.clearRect(0,0,a.width,a.height),ne(i),d.homeScreenFlag&&requestAnimationFrame(()=>{st(i)})}function X(i){d.homeScreenFlag=!0,d.ismute||(e.homeSound&&(e.homeSound.pause(),e.homeSound.currentTime=0),e.homeSound.play()),st(i)}let at,b=[],W=[],J=[],$=[],r,v,mi;function qi(){return new Date().getTime()-at.getTime()}const oe=new Rt(g.tileSize);function ht(){r=new Mt(new t(window.innerWidth/2,window.innerHeight/2),"blue",!0,e.heroTotalHealth,f.width,f.height),r.reheal()}function se(){J=J.filter(i=>i.collected())}function ae(){b=b.filter(i=>{if(i.healthpoint<0)clearInterval(i.attackInterval),J.push(new $t(i.position,16,y[1][0].width*.2,y[1][0].height*.2));else return!0})}function he(){W=W.filter(i=>(i.checkOnhit(b,v),!(i.endPoint.x>=window.innerHeight*g.mapSizeMultiplier||i.startPoint.x<=0||i.isHit))),$=$.filter(i=>(i.checkOnhit(),!(i.position.x>=window.innerHeight*g.mapSizeMultiplier||i.position.x<=0||i.isHit)))}function le(){mi=setInterval(()=>{if(b.length<e.maxEnemies){const i=T(1,100);d.wave>2&&i<40&&b.push(new Nt(new t(T(g.tileSize+g.displayPosition.x,window.innerWidth*5-g.tileSize),T(g.tileSize+g.displayPosition.y,window.innerHeight*5-g.tileSize*2)),"red",!0,m.type2.healthPoint,m.type2.width,m.type2.height,m.type2.damage,m.type2.attackRate,m.type2.image,2,m.type2.velocity)),d.wave>3&&i<50?b.push(new Gt(new t(T(g.tileSize+g.displayPosition.x,window.innerWidth*5-g.tileSize),T(g.tileSize+g.displayPosition.y,window.innerHeight*5-g.tileSize*2)),"red",!0,m.type4.healthPoint,m.type4.width,m.type4.height,m.type4.damage,m.type4.attackRate,m.type4.image,4,m.type4.velocity)):d.wave>1&&i<60?b.push(new _i(new t(T(g.tileSize+g.displayPosition.x,window.innerWidth*5-g.tileSize),T(g.tileSize+g.displayPosition.y,window.innerHeight*5-g.tileSize*2)),"red",!0,m.type3.healthPoint,m.type3.width,m.type3.height,m.type3.damage,m.type3.attackRate,m.type3.image,3,m.type3.velocity)):b.push(new _i(new t(T(g.tileSize+g.displayPosition.x,window.innerWidth*5-g.tileSize),T(g.tileSize+g.displayPosition.y,window.innerHeight*5-g.tileSize*2)),"red",!0,m.type1.healthPoint,m.type1.width,m.type1.height,m.type1.damage,m.type1.attackRate,m.type1.image,1,m.type1.velocity))}},500)}function Ui(){d.ingame=!1,clearInterval(r.abilityInterval),v&&clearInterval(v.attackInterval),e.weaponArray.forEach(i=>{i&&(clearInterval(i.fireInterval),i.detectedEnemy=!1,i.trackingEnemyObj=null)}),e.weaponArray=[],d.wave=1,b.forEach(i=>{i&&clearInterval(i.attackInterval)}),ht()}function re(i){i.drawImage(g.mapImage,g.displayPosition.x,g.displayPosition.y,window.innerWidth*g.mapSizeMultiplier,window.innerHeight*g.mapSizeMultiplier),oe.draw(i),b.forEach(w=>{w.isSpwaned?w.draw(i):w.spwan(i)}),v&&(v.draw(i),e.maxEnemies=50,e.weaponArray.forEach(w=>{w&&w.detectEnemy(v)}),v.healthpoint<=0&&(ci(),Ui(),ai(i,"gameWin","<= return Home",X))),r.draw(i),e.dropdownInterval&&ei(i,`wave : ${d.wave}`);const o=i.createRadialGradient(r.position.x+r.width/2,r.position.y+r.height/2,r.width,r.position.x+r.width/2,r.position.y+r.height/2,1e3);r.healthpoint>30?(o.addColorStop(0,"rgba(10,10,10,0)"),o.addColorStop(1,"rgba(0,0,0,0.99)")):(o.addColorStop(0,"rgba(10,10,10,0)"),o.addColorStop(1,"rgba(200,0,0,0.99)")),i.fillStyle=o,i.fillRect(-e.mapPosition.x,-e.mapPosition.y,a.width,a.height),B(i,new t(a.width*.05-e.mapPosition.x,a.height*.1-e.mapPosition.y),r.healthpoint,e.heroTotalHealth,a.width*.45,a.height*.03,"Life line");const n=`x ${r.gemCount}`;i.drawImage(e.gemImage,y[1][0].position.x,y[1][0].position.y,y[1][0].width,y[1][0].height,a.width*.05-e.mapPosition.x,a.height/5-e.mapPosition.y,y[1][0].width*.3,y[1][0].height*.3),i.font="1rem Eater",i.fillStyle="white";const s=i.measureText(n),h=s.actualBoundingBoxAscent+s.actualBoundingBoxDescent;i.fillText(n,a.width*.05-e.mapPosition.x+y[1][0].width*.5,a.height/5-e.mapPosition.y+h*1.5),i.drawImage(f.sharingan,a.width*.05-e.mapPosition.x,a.height/5-e.mapPosition.y+y[1][0].height*.5,y[1][0].width*.4,y[1][0].height*.4);const l=(new Date().getTime()-r.abilityTime.getTime())/(15*1e3);if(l<1&&!r.abilityInUse?(i.beginPath(),i.fillStyle="rgba(240,240,240,0.6)",i.arc(a.width*.05-e.mapPosition.x+y[1][0].width*.2,a.height/5-e.mapPosition.y+y[1][0].height*.5+y[1][0].height*.2,y[1][0].width*.2,0,2*Math.PI*(1-l)),i.fill()):(i.beginPath(),i.strokeStyle="blue",i.fillStyle="rgba(240,240,240,0.6)",i.arc(a.width*.05-e.mapPosition.x+y[1][0].width*.2,a.height/5-e.mapPosition.y+y[1][0].height*.5+y[1][0].height*.2,y[1][0].width*.2,0,2*Math.PI),i.stroke()),r.staminaUse&&B(i,new t(a.width*.05-e.mapPosition.x,a.height/5-e.mapPosition.y+y[1][0].height*1.5),r.stamina,f.stamina,a.width*.1,a.height*.02,"Stamina","1rem Arial"),B(i,new t(a.width*.95-a.width*.4-e.mapPosition.x,a.height*.1-e.mapPosition.y),r.essenceCount,f.maxEssence,a.width*.4,a.height*.03,"Essence"),qi()>=e.waveIntervalTime&&r.healthpoint>0&&!v&&(d.wave++,e.weaponArray.forEach(w=>{clearInterval(w==null?void 0:w.fireInterval)}),ge(i)),v)ei(i,"Final Wave",new t(-(i.measureText("Final Wave").width/2+e.mapPosition.x),a.height/5-e.mapPosition.y),"0.1rem");else{const w=`${Math.floor((e.waveIntervalTime-qi())/1e3)}`;ei(i,`${w}`,new t(-(i.measureText(w).width/2+e.mapPosition.x),a.height/5-e.mapPosition.y),"0.1rem")}r.healthpoint<=0&&(ci(),Ui(),ai(i,"gameOver","return Home",X)),W.forEach(w=>{w.draw(i)}),$.forEach(w=>{w.draw(i)}),J.forEach(w=>{w.draw(i)}),e.weaponArray.forEach((w,u)=>{w&&(w.draw(i),w.position=r.weaponPositions[u])}),e.maxEnemies=500,et(i)}function lt(i){i==null||i.clearRect(-e.mapPosition.x,-e.mapPosition.y,a.width,a.height),ue(),re(i),ae(),he(),se(),b.forEach(o=>{e.weaponArray.forEach(n=>{n&&n.detectEnemy(o)})}),d.ingame&&requestAnimationFrame(()=>{lt(i)})}function ci(){e.windSound.pause(),e.windSound.currentTime=0,b.forEach(i=>{clearInterval(i.attackInterval)}),v&&(clearInterval(v.attackInterval),clearInterval(v.spitInterval)),r.healthpoint=e.heroTotalHealth,W=[],b=[],$=[],J=[],clearInterval(mi),mi=null,at=new Date,e.weaponArray[0]||(e.weaponArray[0]=new yi(r.weaponPositions[0],!1,c.pistol.damage,c.pistol.width,c.pistol.height,c.pistol.fireRate,c.pistol.cost,c.pistol.image,"pistol",new Audio(c.pistol.soundSrc))),e.weaponArray.forEach((i,o)=>{i&&(clearInterval(i.fireInterval),i.trackingEnemyObj=null,i.detectedEnemy=!1,i.position=r.weaponPositions[o])})}function rt(i){d.ingame=!0,r||ht(),ci(),le(),e.dropdownInterval=!0,setTimeout(()=>{e.dropdownInterval=!1},5e3),e.dropdownInterval&&ei(i,`wave : ${d.wave}`),d.wave>=5&&(v=new qt(new t(T(g.tileSize+g.displayPosition.x,window.innerWidth*5-g.tileSize),T(g.tileSize+g.displayPosition.y,window.innerHeight*5-g.tileSize*2)),"red",!0,m.boss.healthPoint,m.boss.width,m.boss.height,m.boss.damage,m.boss.attackRate,m.boss.image,2,m.boss.velocity),v.changeSpeed()),d.ismute||(e.windSound&&(e.windSound.pause(),e.windSound.currentTime=0),e.windSound.play()),lt(i)}class pe{constructor(o,n,s,h,l){p(this,"startPoint");p(this,"endPoint");p(this,"damage");p(this,"isHit",!1);p(this,"velocity");p(this,"gunPosition");this.startPoint=o,this.endPoint=n,this.damage=s,this.velocity=h,this.gunPosition=l}checkOnhit(o,n=null){o.forEach(s=>{this.endPoint.x>s.position.x&&this.endPoint.x<s.position.x+s.width&&this.endPoint.y>s.position.y&&this.endPoint.y<s.position.y+s.height&&(this.isHit=!0,s.healthpoint-=this.damage)}),n&&this.endPoint.x>n.position.x&&this.endPoint.x<n.position.x+n.width&&this.endPoint.y>n.position.y&&this.endPoint.y<n.position.y+n.height&&(this.isHit=!0,n.healthpoint-=this.damage)}draw(o){this.startPoint=this.startPoint.add(this.velocity),this.endPoint=this.endPoint.add(this.velocity),o.beginPath(),o.strokeStyle="gold",o.moveTo(this.startPoint.x,this.startPoint.y),o.lineTo(this.endPoint.x,this.endPoint.y),o.lineWidth=3,o.stroke()}}class yi{constructor(o,n,s,h,l,w=1,u=500,x,k,O){p(this,"position");p(this,"lookingLeft");p(this,"damage");p(this,"width");p(this,"height");p(this,"spritePosition",0);p(this,"fireRate");p(this,"cost");p(this,"gunImage");p(this,"guntype");p(this,"detectedEnemy",!1);p(this,"trackingEnemyObj",null);p(this,"lookingAngle",0);p(this,"shootingPoint",E.positionRight[1]);p(this,"fireInterval",null);p(this,"level",1);p(this,"sound");this.position=o,this.lookingLeft=n,this.damage=s,this.width=h,this.height=l,this.gunImage=x,this.fireRate=w,this.cost=u,this.guntype=k,this.sound=O}playSound(){d.ismute||(this.sound.volume=.2,this.sound&&(this.sound.pause(),this.sound.currentTime=0),this.sound.play())}detectEnemy(o){const n=this.position;n.distanceBetween(o.position)<L.pestol&&!this.detectedEnemy&&(this.detectedEnemy=!0,this.trackingEnemyObj=o),this.detectedEnemy&&this.trackingEnemyObj&&(this.lookingAngle=n.angle(new t(this.trackingEnemyObj.position.x,this.trackingEnemyObj.position.y)),this.shoot(),this.position.distanceBetween(this.trackingEnemyObj.position)>L.pestol&&(this.detectedEnemy=!1,clearInterval(this.fireInterval),this.fireInterval=null)),this.trackingEnemyObj&&this.trackingEnemyObj.healthpoint<0&&(this.detectedEnemy=!1,clearInterval(this.fireInterval),this.fireInterval=null)}shoot(){this.lookingLeft?this.shootingPoint=new t(this.position.x,this.position.y+this.height/4):this.shootingPoint=new t(this.position.x+this.width,this.position.y+this.height/4),this.trackingEnemyObj&&this.position.x>this.trackingEnemyObj.position.x&&(this.shootingPoint.x=this.position.x),this.shootingPoint.x=this.position.x+(this.shootingPoint.x-this.position.x)*Math.cos(this.lookingAngle)-(this.shootingPoint.y-this.position.y)*Math.sin(this.lookingAngle),this.shootingPoint.y=this.position.y+(this.shootingPoint.x-this.position.x)*Math.sin(this.lookingAngle)+(this.shootingPoint.y-this.position.y)*Math.cos(this.lookingAngle),this.fireInterval||(this.fireInterval=setInterval(()=>{if(this.trackingEnemyObj){const o=new t(this.trackingEnemyObj.position.x+this.trackingEnemyObj.width/2,this.trackingEnemyObj.position.y+this.trackingEnemyObj.height/2),n=this.shootingPoint.pointDifference(o),s=this.shootingPoint.distanceBetween(o),h=new t(n.x/s,n.y/s),l=new t(this.shootingPoint.x+h.x*10,this.shootingPoint.y+h.y*10),w=new pe(this.shootingPoint,l,this.damage,new t(-h.x*L.bulletVelocity,-h.y*L.bulletVelocity),this.position);W.push(w),this.playSound()}},1e3/this.fireRate))}draw(o){let n;switch(this.guntype){case"pistol":n=E;break;case"smg":n=G;break}o.translate(this.position.x,this.position.y),o.rotate(this.lookingAngle);let s;this.lookingLeft?(s=n.positionLeft[0],this.shootingPoint=new t(0,this.height/4)):(s=n.positionRight[0],this.shootingPoint=new t(this.width,this.height/4)),this.trackingEnemyObj&&this.position.x>this.trackingEnemyObj.position.x&&(s=s===E.positionLeft[0]?E.positionRight[0]:E.positionLeft[0],this.shootingPoint.x=0),o.fillStyle="red",o.drawImage(this.gunImage,s.x,s.y,E.width,E.height,0,0,this.width,this.height),o.rotate(-this.lookingAngle),o.translate(-this.position.x,-this.position.y)}}let pt,P=0;function Vi(){return new Date().getTime()-pt.getTime()}function Yi(i,o,n){const s=n.x,h=n.y;return i=new t(i.x-e.mapPosition.x,i.y-e.mapPosition.y),i.x>o.x&&i.x<o.x+s&&i.y>o.y&&i.y<o.y+h}let de=i=>{for(let h=0;h<6;h++)if(Yi(i,new t(-e.mapPosition.x+a.width*(.2+.1*h+.025),-e.mapPosition.y+a.height*.8300000000000001),new t(a.width*.05,a.width*.05))){P=h;break}const o=a.width*.8-e.mapPosition.x,n=a.height*.5-e.mapPosition.y,s=new t(a.width*.1-e.mapPosition.x,a.height*.1-e.mapPosition.y);for(let h=0;h<4;h++)if(Yi(i,new t(s.x+o*h/4,s.y),new t(o/4,n))){switch(h){case 0:r.gemCount>=c.pistol.cost&&(e.weaponArray[P]=new yi(r.weaponPositions[P],!1,c.pistol.damage,c.pistol.width,c.pistol.height,c.pistol.fireRate,c.pistol.cost,c.pistol.image,"pistol",new Audio(c.pistol.soundSrc)),r.gemCount-=c.pistol.cost);break;case 1:r.gemCount>=c.smg.cost&&(e.weaponArray[P]=new yi(r.weaponPositions[P],!1,c.smg.damage,c.smg.width,c.smg.height,c.smg.fireRate,c.smg.cost,c.smg.image,"smg",new Audio(c.smg.soundSrc)),r.gemCount-=c.smg.cost);break}for(let w=0;w<e.weaponArray.length&&(P=w,!!e.weaponArray[w]);w++);break}};function we(){e.weaponArray[P]&&e.weaponArray[P].level<3&&r.gemCount>=e.weaponArray[P].cost*1.1?(e.weaponArray[P].damage+=e.weaponArray[P].damage*.1,e.weaponArray[P].fireRate+=e.weaponArray[P].fireRate*.1,e.weaponArray[P].level++,r.gemCount-=e.weaponArray[P].cost*.1):(e.denySound&&(e.denySound.pause(),e.denySound.currentTime=0),e.denySound.play())}function Xi(i,o,n,s,h,l,w,u,x,k,O,z,F,Q){i.strokeRect(n.x+s*o/4,n.y,s/4,h),i.fillRect(n.x+s*o/4+s/8-l/2,n.y*1.3,l,l),i.drawImage(w,u.x,u.y,x,k,n.x+s*o/4+s/8-l/2,n.y*1.3,l,l),i.font="2rem Eater",i.fillStyle="white";const K=i.measureText("sample"),Z=K.actualBoundingBoxAscent+K.actualBoundingBoxDescent;i.fillText(`Gun: ${O}`,n.x+s*o/4+l/2,n.y*1.3+l+Z*4),i.fillText(`Cost: ${z}`,n.x+s*o/4+l/2,n.y*1.3+l+Z*5.5),i.fillText(`Damage: ${F}`,n.x+s*o/4+l/2,n.y*1.3+l+Z*7),i.fillText(`Fire Rate: ${Q}`,n.x+s*o/4+l/2,n.y*1.3+l+Z*8.5)}function dt(i){const o=a.width*.8-e.mapPosition.x,n=a.height*.5-e.mapPosition.y,s=new t(a.width*.1-e.mapPosition.x,a.height*.1-e.mapPosition.y),h=a.width*.05;i==null||i.clearRect(-e.mapPosition.x,-e.mapPosition.y,a.width,a.height),i.fillStyle="rgba(10,10,40,0.5)",i.fillRect(s.x,s.y,o,n),i.font="3rem ShadowOfTheDeadOver",i.fillStyle="#4caf50",i.fillText("Buy Menu: ",a.width*.1-e.mapPosition.x,a.height*.1-e.mapPosition.y),i.font="2rem Eater",i.fillStyle="#4caf50",i.fillText(`Gems Count: ${r.gemCount}`,a.width*.8-e.mapPosition.x,a.height*.1-e.mapPosition.y),i.fillStyle="rgba(200,200,200,0.8)",i.strokeStyle="green",Xi(i,0,s,o,n,h,c.pistol.image,E.positionRight[0],E.width,E.height,"Pistol",c.pistol.cost,c.pistol.damage,c.pistol.fireRate),Xi(i,1,s,o,n,h,c.smg.image,G.positionRight[0],G.width,G.height,"SMG",c.smg.cost,c.smg.damage,c.smg.fireRate),et(i),i.strokeStyle="gold",i.strokeRect(-e.mapPosition.x+a.width*(.2+.1*P+.025),-e.mapPosition.y+a.height*(.8+.03),a.width*.05,a.width*.05),B(i,new t(a.width*.1-e.mapPosition.x,a.height*.7-e.mapPosition.y),Vi(),e.buyTime,a.width*.8,a.height*.01,"Buy Time:"),Vi()>=e.buyTime&&(e.weaponArray.forEach((l,w)=>{l&&(l.position=r.weaponPositions[w])}),d.buyScreenFlag=!1,rt(i)),d.ingame||requestAnimationFrame(()=>{dt(i)})}function ge(i){i.translate(-e.mapPosition.x,-e.mapPosition.y),e.mapPosition=new t(0,0),d.ingame=!1,d.buyScreenFlag=!0,pt=new Date,P=0;for(let o=0;o<e.weaponArray.length&&(P=o,!!e.weaponArray[o]);o++);dt(i)}let fi,ui;function me(i,o){i=new t(-e.mapPosition.x+i.x,-e.mapPosition.y+i.y),ui&&N(i,fi,ui)&&(d.firstPageFlag=!1,X(o))}function ce(i){i.clearRect(-e.mapPosition.x,-e.mapPosition.y,a.width,a.height),i.drawImage(Y.backGroundImage,-e.mapPosition.x,-e.mapPosition.y,a.width,a.height);const o="DUNGEON DREAD";i.font="3rem ShadowOfTheDeadOver",i.fillStyle="white";const n=i.measureText(o);i.fillText(o,a.width*.5-n.width/2,a.height*.3+n.actualBoundingBoxAscent+n.actualBoundingBoxDescent),i.font="3rem Eater",fi=new t(a.width*.5-i.measureText("ENTER").width/2,-e.mapPosition.y+a.height*.8),ui=_(i,"ENTER",fi)}function wt(i){i.clearRect(0,0,a.width,a.height),ce(i),d.homeScreenFlag&&requestAnimationFrame(()=>{wt(i)})}function ye(i){d.firstPageFlag=!0,e.homeSound&&(e.homeSound.pause(),e.homeSound.currentTime=0),wt(i)}function fe(){d.ismute=!d.ismute,d.ismute?(e.homeSound.pause(),e.homeSound.currentTime=0,e.windSound.pause(),e.windSound.currentTime=0):(d.homeScreenFlag&&e.homeSound.play(),d.ingame&&e.windSound.play())}function ue(){d.btnPressed.a&&d.btnPressed.w||d.btnPressed.a&&d.btnPressed.s||d.btnPressed.d&&d.btnPressed.w||d.btnPressed.d&&d.btnPressed.s?(r.velocity.x=.7*f.velocity.x,r.velocity.y=.7*f.velocity.y):d.btnPressed.c&&(d.btnPressed.w||d.btnPressed.a||d.btnPressed.s||d.btnPressed.d)?r.run():(r.velocity.x=f.velocity.x,r.velocity.y=f.velocity.y),d.btnPressed.a&&(r.isMoving=!0,r.moveLeft(!0,R)),d.btnPressed.d&&(r.isMoving=!0,r.moveLeft(!1,R)),d.btnPressed.w&&(r.moveUp(!0,R),r.isMoving=!0),d.btnPressed.s&&(r.moveUp(!1,R),r.isMoving=!0),d.btnPressed[" "]&&r.ability()}function Se(){window.addEventListener("keydown",i=>{d.btnPressed[i.key.toLowerCase()]=!0,d.buyScreenFlag&&d.btnPressed.u&&(console.log("here"),we()),i.key.toLowerCase()==="m"&&fe()}),window.addEventListener("keyup",i=>{d.btnPressed[i.key.toLowerCase()]=!1,r.isMoving=!1}),window.addEventListener("click",i=>{d.firstPageFlag&&me(new t(i.offsetX,i.offsetY),R),d.homeScreenFlag&&te(new t(i.offsetX,i.offsetY),R),d.buyScreenFlag&&de(new t(i.offsetX,i.offsetY)),d.infoScreenFlag&&Jt(new t(i.offsetX,i.offsetY),R),d.controlScreenFlag&&Kt(new t(i.offsetX,i.offsetY),R)})}function Pe(i){i.clearRect(-e.mapPosition.x,-e.mapPosition.y,a.width,a.height),i.fillStyle="rgba(40,40,240,1)",i.fillRect(-e.mapPosition.x,-e.mapPosition.y,a.width,a.height),i.fillStyle="rgba(40,40,40,0.1)",i.fillRect(-e.mapPosition.x,-e.mapPosition.y,a.width,a.height);const o="DUNGEON DREAD";i.font="3rem ShadowOfTheDeadOver",i.fillStyle="white";const n=i.measureText(o);i.fillText(o,-e.mapPosition.x+a.width*.01,-e.mapPosition.y+a.height*.01+n.actualBoundingBoxAscent+n.actualBoundingBoxDescent),B(i,new t(a.width*.3,a.height*.5),d.assetsLoaded,18,a.width*.4,10,"Loading... ","4rem Arial","white"),d.assetsLoaded>=16&&(d.loadingScreen=!1,ye(i))}function gt(i){i.clearRect(0,0,a.width,a.height),Pe(i),d.loadingScreen&&requestAnimationFrame(()=>{gt(i)})}function ve(i){d.loadingScreen=!0,d.ismute||(e.homeSound&&(e.homeSound.pause(),e.homeSound.currentTime=0),e.homeSound.play()),gt(i)}const a=document.getElementById("canvas"),R=a.getContext("2d");Se();a&&(a.width=window.innerWidth,a.height=window.innerHeight,a.style.background="linear-gradient(172.33deg, #30303A -1.75%, #20202E 83.53%, #050519 104.9%)",ve(R));
