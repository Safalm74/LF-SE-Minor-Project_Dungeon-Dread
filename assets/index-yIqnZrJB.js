var ft=Object.defineProperty;var St=(i,n,o)=>n in i?ft(i,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):i[n]=o;var d=(i,n,o)=>St(i,typeof n!="symbol"?n+"":n,o);(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const l of a)if(l.type==="childList")for(const g of l.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&s(g)}).observe(document,{childList:!0,subtree:!0});function o(a){const l={};return a.integrity&&(l.integrity=a.integrity),a.referrerPolicy&&(l.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?l.credentials="include":a.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function s(a){if(a.ep)return;a.ep=!0;const l=o(a);fetch(a.href,l)}})();class t{constructor(n,o){d(this,"x");d(this,"y");this.x=n,this.y=o}distanceBetween(n){return Math.sqrt((this.x-n.x)**2+(this.y-n.y)**2)}angle(n){const o=this.x-n.x,s=this.y-n.y;return Math.atan(s/o)}add(n){return new t(this.x+n.x,this.y+n.y)}pointDifference(n){return new t(this.x-n.x,this.y-n.y)}}const vt="/LF-SE-Minor-Project_Dungeon-Dread/assets/hero-bHENNDIt.png",p={ingame:!1,aboutScreenFlag:!1,controlScreenFlag:!1,homeScreenFlag:!1,btnPressed:{},wave:1,buyScreenFlag:!1,ismute:!1,firstPageFlag:!1,assetsLoaded:0,loadingScreen:!1,infoScreenFlag:!1};function v(){p.assetsLoaded++}const L={positionRight:[{width:55,height:96,position:new t(5,0)},{width:86,height:88,position:new t(4,122)},{width:85,height:88,position:new t(104,123)},{width:84,height:90,position:new t(201,121)},{width:85,height:89,position:new t(302,122)},{width:84,height:88,position:new t(400,123)},{width:84,height:90,position:new t(500,121)}],positionLeft:[{width:55,height:96,position:new t(533,219)},{width:86,height:88,position:new t(503,341)},{width:85,height:88,position:new t(404,342)},{width:84,height:90,position:new t(308,340)},{width:85,height:89,position:new t(206,341)},{width:84,height:88,position:new t(109,342)},{width:84,height:90,position:new t(9,340)}]},Ki="/LF-SE-Minor-Project_Dungeon-Dread/assets/amaterasu-BhcJas4O.mp3",Pt="/LF-SE-Minor-Project_Dungeon-Dread/assets/amaterasu-Bq5RU4UD.png",It="/LF-SE-Minor-Project_Dungeon-Dread/assets/sharingan-CjDJlJ4A.png",Zi=new Image,Ii=new Image,ki=new Image;Ii.src=Pt;Zi.src=It;ki.src=vt;const it=new Audio(Ki),tt=new Audio(Ki);tt.onload=v;Ii.onload=v;ki.onload=v;it.onload=v;const u={heroTotalHealth:200,width:L.positionLeft[0].width*window.innerHeight/1200,height:L.positionLeft[0].height*window.innerHeight/1200,velocity:new t(5,5),abilityDamage:.1,abilityRate:10,abilityDurability:10*1e3,maxEssence:50,amaterasuSound:tt,heavyBreath:it,stamina:10,image:ki,amatherasuImage:Ii,sharingan:Zi},kt="/LF-SE-Minor-Project_Dungeon-Dread/assets/stoneandDrum-BzVPJaqp.svg",bt="/LF-SE-Minor-Project_Dungeon-Dread/assets/bush-fjx7lCik.png",xt="/LF-SE-Minor-Project_Dungeon-Dread/assets/map-BCq2fiXg.png",bi=new Image,xi=new Image,Ti=new Image;bi.src=xt;xi.src=bt;Ti.src=kt;bi.onload=v;xi.onload=v;Ti.onload=v;let Tt=[];const Ei=50,Et=Math.floor(window.innerWidth*10/Ei),Dt=Math.floor(window.innerHeight*10/Ei),At="#radial-gradient(#a9c0a6,#000)",m={tileSize:Ei,mapWidth:Et,mapHeight:Dt,mapColor:At,mapTileArray:Tt,displayPosition:new t(0,0),mapSizeMultiplier:5,bushImage:xi,stoneImage:Ti,mapImage:bi},Rt="/LF-SE-Minor-Project_Dungeon-Dread/assets/homeMusic-CTRQ4BfC.mp3",Ot="/LF-SE-Minor-Project_Dungeon-Dread/assets/wind-1mG3RRHB.mp3",Lt="/LF-SE-Minor-Project_Dungeon-Dread/assets/gem-CYeD5NUz.png",Mt="/LF-SE-Minor-Project_Dungeon-Dread/assets/coinCollect-D0EQSH2R.wav",Ft="/LF-SE-Minor-Project_Dungeon-Dread/assets/deny-zoSqCo59.mp3",Di=new Image;Di.src=Lt;const Ai=new Audio(Rt),Ri=new Audio(Ot),Oi=new Audio(Mt),Li=new Audio(Ft);Ai.onload=v;Ri.onload=v;Oi.onload=v;Li.onload=v;Di.onload=v;Ai.volume=.5;Ri.volume=.5;Oi.volume=.2;Li.volume=.5;const e={collideableObjs:[],heroTotalHealth:120,waveIntervalTime:90*1e3,buyTime:30*1e3,maxEnemies:100*m.mapSizeMultiplier,mapPosition:new t(0,0),dropdownInterval:null,weaponArray:[null,null,null,null,null,null],homeSound:Ai,windSound:Ri,gemSound:Oi,denySound:Li,gemImage:Di},M={bulletSize:2,bulletVelocity:20,pestol:300,pestolFireRate:1,pestolDamage:5},oi={width:115,height:62,position:new t(27,18)},D={drum:{width:738,height:226,position:new t(590,2280)},stone:{width:1663,height:1487,position:new t(577,773)}};class si{constructor(n,o,s,a){d(this,"position");d(this,"tileType");d(this,"isObstacle");d(this,"tileSize");this.position=n,this.tileType=o,this.isObstacle=s,this.tileSize=a}draw(n){switch(this.tileType){case"bush":n.drawImage(m.bushImage,oi.position.x,oi.position.y,oi.width,oi.height,this.position.x,this.position.y,this.tileSize,this.tileSize);break;case"empty":break;case"stone":n.drawImage(m.stoneImage,D.stone.position.x,D.stone.position.y,D.stone.width,D.stone.height,this.position.x,this.position.y,D.stone.width/30,D.stone.height/30);break;case"drum":n.drawImage(m.stoneImage,D.drum.position.x,D.drum.position.y,D.drum.width,D.drum.height,this.position.x,this.position.y,this.tileSize,this.tileSize);break}}}function E(i,n){const o=Math.ceil(i),s=Math.floor(n);return Math.floor(Math.random()*(s-o+1)+o)}class Ht{constructor(n){d(this,"tileSize");d(this,"mapHeight");d(this,"mapWidth");this.tileSize=n,this.mapHeight=Math.floor(window.innerHeight*m.mapSizeMultiplier/n),this.mapWidth=Math.floor(window.innerWidth*m.mapSizeMultiplier/n),this.initialize(),this.collectCollideableobj()}collectCollideableobj(){m.mapTileArray.forEach(n=>{n.forEach(o=>{o.isObstacle&&e.collideableObjs.push(o)})})}initialize(){for(let n=0;n<this.mapHeight;n++){m.mapTileArray[n]=[];for(let o=0;o<this.mapWidth;o++)if(o===0||n===0||n===this.mapHeight-1||o===this.mapWidth-1)m.mapTileArray[n][o]=new si(new t(o*this.tileSize,n*this.tileSize),"bush",!0,this.tileSize);else{const s=E(1,100);s%2==0&&s<10?s>5?m.mapTileArray[n][o]=new si(new t(o*this.tileSize,n*this.tileSize),"drum",!0,this.tileSize):m.mapTileArray[n][o]=new si(new t(o*this.tileSize,n*this.tileSize),"stone",!0,this.tileSize):m.mapTileArray[n][o]=new si(new t(o*this.tileSize,n*this.tileSize),"empty",!1,this.tileSize)}}}draw(n){m.mapTileArray.forEach(o=>{o.forEach(s=>{s.draw(n)})})}}class ii{constructor(n,o,s,a,l,g,S=0,T=0,b=new Image,R=0,z=new t(5,5)){d(this,"position");d(this,"team");d(this,"lookingLeft");d(this,"healthpoint");d(this,"width");d(this,"height");d(this,"spritePosition",0);d(this,"velocity");d(this,"damage");d(this,"attackRate");d(this,"gruntImage");d(this,"gruntType");this.position=n,this.team=o,this.lookingLeft=s,this.healthpoint=a,this.width=l,this.height=g,this.damage=S,this.attackRate=T,this.gruntImage=b,this.gruntType=R,this.velocity=z}}const Y={width:339,height:404,position:[new t(6,13),new t(345,13),new t(684,13),new t(1024,13),new t(1365,13),new t(1706,13),new t(2047,13),new t(2388,13)]};class Ct extends ii{constructor(){super(...arguments);d(this,"isMoving",!1);d(this,"speedLimit",3);d(this,"weaponOffset",15);d(this,"abilityInterval",null);d(this,"abilityDamage",u.abilityDamage);d(this,"abilityDurability",u.abilityDurability);d(this,"abilityRate",u.abilityRate);d(this,"abilityInUse",!1);d(this,"inRangeEnemies",[]);d(this,"abilityTime",new Date);d(this,"stamina",u.stamina);d(this,"staminaInterval");d(this,"healthInterval");d(this,"staminaUse",!1);d(this,"gemCount",0);d(this,"essenceCount",0);d(this,"weaponPositions",[new t(this.position.x+this.weaponOffset+this.width,this.position.y),new t(this.position.x-this.weaponOffset,this.position.y),new t(this.position.x+this.weaponOffset+this.width,this.position.y+this.height/2),new t(this.position.x-this.weaponOffset,this.position.y+this.height/2),new t(this.position.x+this.weaponOffset+this.width,this.position.y),new t(this.position.x+this.weaponOffset+this.width,this.position.y)])}ability(){!this.abilityInUse&&new Date().getTime()-this.abilityTime.getTime()>15*1e3&&this.essenceCount&&(this.abilityInUse=!0,u.amaterasuSound.currentTime=2,u.amaterasuSound.play(),this.inRangeEnemies=k.filter(o=>{if(o.position.x>-e.mapPosition.x&&o.position.x<-e.mapPosition.x+h.width&&o.position.y>-e.mapPosition.y&&o.position.y<-e.mapPosition.y+h.height)return!0}),y&&this.inRangeEnemies.push(y),setTimeout(()=>{this.inRangeEnemies=[],this.abilityInUse=!1},this.abilityDurability*(this.essenceCount/u.maxEssence)),this.abilityTime=new Date,this.essenceCount=0)}reheal(){this.healthInterval=setInterval(()=>{this.healthpoint<50&&(u.heavyBreath.played||u.heavyBreath.play(),this.healthpoint+=3)},5e3),this.staminaInterval=setInterval(()=>{this.stamina<u.stamina&&(this.stamina+=1),this.staminaUse=!1},2e3)}run(){this.staminaUse=!0,this.stamina>0&&(this.velocity=new t(7,7),this.stamina-=.1)}checkCollision(){let o=!1,s=e.collideableObjs[0];return e.collideableObjs.forEach(a=>{a.position.y+a.tileSize>=this.position.y&&a.position.y<=this.position.y+this.height&&a.position.x+a.tileSize>=this.position.x&&a.position.x+a.tileSize<=this.position.x+a.tileSize+this.width&&(o=!0,s=a)}),{collided:o,collidedObj:s}}updateWeaponPosition(){this.weaponPositions=[new t(this.position.x+this.weaponOffset+this.width,this.position.y),new t(this.position.x-this.weaponOffset,this.position.y),new t(this.position.x+this.weaponOffset+this.width,this.position.y+this.height/2),new t(this.position.x-this.weaponOffset,this.position.y+this.height/2),new t(this.position.x+this.weaponOffset+this.width,this.position.y+this.height),new t(this.position.x-this.weaponOffset,this.position.y+this.height)]}moveLeft(o,s){const a=o?this.velocity.x:-1*this.velocity.x;this.lookingLeft=o;const l=this.checkCollision();if(!l.collided)e.mapPosition.x+=a,s.translate(a,0);else{const g=l.collidedObj.position.y<this.position.y?-1:1,S=l.collidedObj.position.x<this.position.x?-1:1;e.mapPosition.x+=S,e.mapPosition.y+=g,s.translate(S,g)}}moveUp(o,s){const a=o?this.velocity.y:-1*this.velocity.y,l=this.checkCollision();if(!l.collided)e.mapPosition.y+=a,s.translate(0,a);else{const g=l.collidedObj.position.y<this.position.y?-1:1,S=l.collidedObj.position.x<this.position.x?-1:1;e.mapPosition.x+=S,e.mapPosition.y+=g,s.translate(S,g)}}draw(o){this.updateWeaponPosition(),this.position.x=h.width/2-e.mapPosition.x,this.position.y=h.height/2-e.mapPosition.y,this.inRangeEnemies.forEach(a=>{let l=Math.floor(this.spritePosition/5)%Y.position.length;o.drawImage(u.amatherasuImage,Y.position[l].x,Y.position[l].y,Y.width,Y.height,a.position.x,a.position.y,a.width,a.height),a.healthpoint-=this.abilityDamage});const s=this.lookingLeft?L.positionLeft:L.positionRight;if(this.isMoving){const a=20/this.velocity.x*.9;let l=Math.floor(this.spritePosition/a)%(s.length-1)+1;this.width=L.positionLeft[l].width*window.innerHeight/1200,this.height=L.positionLeft[l].height*window.innerHeight/1200,o.drawImage(u.image,s[l].position.x,s[l].position.y,s[l].width,s[l].height,this.position.x,this.position.y,this.width,this.height)}else this.width=L.positionLeft[0].width*window.innerHeight/1200,this.height=L.positionLeft[0].height*window.innerHeight/1200,o.drawImage(u.image,s[0].position.x,s[0].position.y,s[0].width,s[0].height,this.position.x,this.position.y,this.width,this.height);this.spritePosition++}}const I={width:31,height:17,position:[new t(76,17),new t(224,17),new t(410,17),new t(576,17),new t(742,17),new t(76,118),new t(224,118),new t(410,118),new t(576,118),new t(742,118),new t(48,217)]},li={width:24,height:34,positionLeft:[new t(10,3),new t(118,3),new t(226,3),new t(335,3),new t(443,3),new t(6,114),new t(443,3),new t(335,3),new t(226,3),new t(118,3)],positionRight:[new t(479,2),new t(587,2),new t(696,3),new t(804,5),new t(914,5),new t(482,112),new t(914,5),new t(804,5),new t(696,3),new t(587,2)]},W={width:34,height:30,positionRight:[new t(84,542),new t(121,541),new t(158,542),new t(195,541)],positionLeft:[new t(343,541),new t(308,542),new t(269,541),new t(232,542)]},zt="/LF-SE-Minor-Project_Dungeon-Dread/assets/type_3_4_-0Cq7KuU3.png",Bt="/LF-SE-Minor-Project_Dungeon-Dread/assets/type1-CCCx1Bt1.png",_t="/LF-SE-Minor-Project_Dungeon-Dread/assets/type2-BH0ylXV7.png",Gt="/LF-SE-Minor-Project_Dungeon-Dread/assets/bossLeft-CV5mu1oo.png",Nt="/LF-SE-Minor-Project_Dungeon-Dread/assets/bossRight-CcEZmngP.png",qt="/LF-SE-Minor-Project_Dungeon-Dread/assets/spwan-6_Ug9n4C.png",Mi=new Image;Mi.src=qt;const Fi=new Image,J=new Image,Hi=new Image;Fi.src=Bt;J.src=zt;Hi.src=_t;const Ci=new Image;Ci.src=Gt;const zi=new Image;zi.src=Nt;Fi.onload=v;J.onload=v;Hi.onload=v;Ci.onload=v;Mi.onload=v;zi.onload=v;const c={type1:{healthPoint:10,width:li.width*window.innerHeight/700,height:li.height*window.innerHeight/700,image:Fi,attackRate:2,damage:2,velocity:new t(1,1)},type2:{healthPoint:20,width:window.innerHeight/1500,height:window.innerHeight/1500,image:Hi,attackRate:2,damage:2,velocity:new t(1,1)},type3:{healthPoint:15,width:W.width*window.innerHeight/700,height:W.height*window.innerHeight/700,image:J,attackRate:3,damage:6,velocity:new t(3,3)},type4:{healthPoint:28,width:window.innerHeight/500,height:window.innerHeight/500,image:J,attackRate:1,damage:3,velocity:new t(1,1)},boss:{healthPoint:800,width:window.innerHeight/500,height:window.innerHeight/500,image:J,attackRate:1,damage:30,velocity:new t(1,1),velocityFast:new t(4,4),imageLeft:Ci,imageRight:zi},spwanImage:Mi};class Ui extends ii{constructor(){super(...arguments);d(this,"isSpwaned",!1);d(this,"attackInterval",null)}checkCollision(){let o=!1,s=!1,a=e.collideableObjs[0];return e.collideableObjs.forEach(l=>{l.position.y+l.tileSize>=this.position.y&&l.position.y<=this.position.y+this.height&&l.position.x+l.tileSize>=this.position.x&&l.position.x+l.tileSize<=this.position.x+l.tileSize+this.width&&(o=!0,a=l)}),r.position.y+r.height/2>=this.position.y&&r.position.y<=this.position.y+this.height&&r.position.x+r.width>=this.position.x&&r.position.x+r.width<=this.position.x+r.width+this.width?(s=!0,a=r,this.attackInterval||(this.attackInterval=setInterval(()=>{r.healthpoint>0&&(r.healthpoint-=this.damage)},1e3/this.attackRate))):(clearInterval(this.attackInterval),this.attackInterval=null),{collided:o,collidedObj:a,collidedHero:s}}update(){const o=this.checkCollision();this.lookingLeft=this.position.x>r.position.x;const s=Math.sqrt((this.position.x-r.position.x)**2+(this.position.y-r.position.y)**2);s>50&&(clearInterval(this.attackInterval),this.attackInterval=null);const a=new t((this.position.x-r.position.x)/s,(this.position.y-r.position.y)/s),l=Math.sqrt(this.velocity.x*this.velocity.x+this.velocity.y*this.velocity.y),g=new t(-a.x*l,-a.y*l);if(!o.collidedHero&&!o.collided&&(this.position.x+=g.x,this.position.y+=g.y),o.collided){const S=o.collidedObj.position.x<this.position.x?1:-1,T=o.collidedObj.position.y<this.position.y?1:-1;this.position.x+=S,this.position.y+=T}}draw(o){if(this.isSpwaned){let s;switch(this.gruntType){case 1:s=li;break;case 3:s=W;break}const a=this.lookingLeft?s.positionLeft:s.positionRight;this.update();let g=Math.floor(this.spritePosition/5)%s.positionLeft.length;o.drawImage(this.gruntImage,a[g].x,a[g].y,W.width,W.height,this.position.x,this.position.y,this.width,this.height),this.spritePosition++}}spwan(o){let a=Math.floor(this.spritePosition/10)%I.position.length;o.drawImage(c.spwanImage,I.position[a].x,I.position[a].y,I.width,I.height,this.position.x,this.position.y,this.width,this.height),this.spritePosition++,a>=9&&(this.isSpwaned=!0,this.spritePosition=0)}}const A={width:45,height:55,positionRight:[new t(93,226),new t(142,230),new t(189,235),new t(229,231)],positionLeft:[new t(278,235),new t(326,231),new t(372,225),new t(414,230)],attackLeft:[{width:34,height:58,position:new t(173,283)},{width:64,height:41,position:new t(208,300)},{width:53,height:42,position:new t(273,305)}],attackRight:[{width:33,height:58,position:new t(20,283)},{width:64,height:41,position:new t(54,300)},{width:53,height:41,position:new t(119,306)}]};class Vt extends ii{constructor(){super(...arguments);d(this,"isSpwaned",!1);d(this,"attackInterval",null);d(this,"isAttacking",!1)}checkCollision(){let o=!1,s=!1,a=e.collideableObjs[0];return e.collideableObjs.forEach(l=>{l.position.y+l.tileSize>=this.position.y&&l.position.y<=this.position.y+this.height&&l.position.x+l.tileSize>=this.position.x&&l.position.x+l.tileSize<=this.position.x+l.tileSize+this.width&&(o=!0,a=l)}),r.position.y+r.height/2>=this.position.y&&r.position.y<=this.position.y+this.height&&r.position.x+r.width>=this.position.x&&r.position.x+r.width<=this.position.x+r.width+this.width&&(s=!0,a=r),{collided:o,collidedObj:a,collidedHero:s}}update(){const o=this.checkCollision();this.lookingLeft=this.position.x>r.position.x;const s=Math.sqrt((this.position.x-r.position.x)**2+(this.position.y-r.position.y)**2);s>50&&(clearInterval(this.attackInterval),this.attackInterval=null);const a=new t((this.position.x-r.position.x)/s,(this.position.y-r.position.y)/s),l=Math.sqrt(2);if(this.velocity=new t(-a.x*l,-a.y*l),o.collidedHero?this.isAttacking=!0:(this.position.x+=this.velocity.x,this.position.y+=this.velocity.y,this.isAttacking=!1),!o.collided)this.position.x+=this.velocity.x,this.position.y+=this.velocity.y;else{const g=o.collidedObj.position.x<this.position.x?1:-1,S=o.collidedObj.position.y<this.position.y?1:-1;this.position.x+=g,this.position.y+=S}}draw(o){if(this.update(),this.isAttacking){const s=this.lookingLeft?A.attackLeft:A.attackRight,a=10,l=Math.floor(this.spritePosition/a)%A.attackLeft.length;this.height=s[l].height,this.width=s[l].width,l===2&&this.spritePosition%a===0&&(r.healthpoint-=this.damage),o.drawImage(c.type3.image,s[l].position.x,s[l].position.y,s[l].width,s[l].height,this.position.x,this.position.y,this.width,this.height)}else{const s=this.lookingLeft?A.positionLeft:A.positionRight,l=Math.floor(this.spritePosition/8)%A.positionLeft.length;this.width=A.width,this.height=A.height,o.drawImage(c.type3.image,s[l].x,s[l].y,A.width,A.height,this.position.x,this.position.y,this.width,this.height)}this.spritePosition++}spwan(o){const a=Math.floor(this.spritePosition/10)%I.position.length;o.drawImage(c.spwanImage,I.position[a].x,I.position[a].y,I.width,I.height,this.position.x,this.position.y,this.width,this.height),this.spritePosition++,a>=9&&(this.isSpwaned=!0,this.spritePosition=0)}}class et{constructor(n,o,s,a){d(this,"position");d(this,"damage");d(this,"isHit",!1);d(this,"velocity");d(this,"gunPosition");d(this,"radius",window.innerWidth/100);this.position=n,this.damage=o,this.velocity=s,this.gunPosition=a}checkOnhit(){this.position.x-this.radius>r.position.x&&this.position.x+this.radius<r.position.x+r.width&&this.position.y-this.radius>r.position.y&&this.position.y+this.radius<r.position.y+r.height&&(this.isHit=!0,r.healthpoint-=this.damage)}update(){this.position.x+=this.velocity.x,this.position.y+=this.velocity.y}draw(n){this.update(),n.beginPath(),n.fillStyle="green",n.arc(this.position.x,this.position.y,this.radius,0,Math.PI*2),n.fill()}}const $t={position:[{width:137,height:79,position:new t(12,28)},{width:144,height:78,position:new t(168,28)},{width:147,height:77,position:new t(326,29)},{width:144,height:76,position:new t(488,28)},{width:127,height:80,position:new t(659,27)},{width:111,height:83,position:new t(27,168)},{width:127,height:80,position:new t(179,167)}]};class Ut extends ii{constructor(){super(...arguments);d(this,"isSpwaned",!1);d(this,"attackInterval",null);d(this,"attackRadius",400);d(this,"spitRange",200)}update(){const o=Math.sqrt((this.position.x-r.position.x)**2+(this.position.y-r.position.y)**2),s=new t((this.position.x-r.position.x)/o,(this.position.y-r.position.y)/o),a=Math.sqrt(this.velocity.x*this.velocity.x+this.velocity.y*this.velocity.y),l=new t(-s.x*a,-s.y*a);o>this.spitRange?(clearInterval(this.attackInterval),this.attackInterval=null,this.position.x+=l.x,this.position.y+=l.y):this.spitHero()}spitHero(){this.attackInterval||(this.attackInterval=setInterval(()=>{if(r){const o=new t(r.position.x,r.position.y),s=this.position.pointDifference(o),a=this.position.distanceBetween(o),l=new t(s.x/a,s.y/a),g=new et(new t(this.position.x+this.width/2,this.position.y+this.width/2),this.damage,new t(-l.x*M.bulletVelocity*.3,-l.y*M.bulletVelocity*.3),this.position);U.push(g)}},1e3/this.attackRate))}draw(o){const s=$t;this.update();let l=Math.floor(this.spritePosition/5)%s.position.length;this.width=s.position[l].width,this.height=s.position[l].height,o.drawImage(this.gruntImage,s.position[l].position.x,s.position[l].position.y,s.position[l].width,s.position[l].height,this.position.x,this.position.y,s.position[l].width*c.type2.width,s.position[l].height*c.type2.height),this.spritePosition++}spwan(o){let a=Math.floor(this.spritePosition/10)%I.position.length;o.drawImage(c.spwanImage,I.position[a].x,I.position[a].y,I.width,I.height,this.position.x,this.position.y,this.width,this.height),this.spritePosition++,a>=9&&(this.isSpwaned=!0,this.spritePosition=0)}}const f={1:[{width:80,height:80,position:new t(91,7)},{width:77,height:80,position:new t(172,7)},{width:57,height:80,position:new t(262,7)},{width:40,height:80,position:new t(351,7)},{width:57,height:80,position:new t(422,7)},{width:77,height:80,position:new t(492,7)}]};class Yt{constructor(n,o,s,a){d(this,"position");d(this,"value");d(this,"spritePostion",0);d(this,"width");d(this,"height");this.position=n,this.value=o,this.width=s,this.height=a}draw(n){const s=Math.floor(this.spritePostion/5)%f[1].length;n.drawImage(e.gemImage,f[1][s].position.x,f[1][s].position.y,f[1][s].width,f[1][s].height,this.position.x,this.position.y,f[1][s].width*.3,f[1][s].height*.3),this.spritePostion++}collected(){return r.position.y+r.height+20>=this.position.y&&r.position.y-20<=this.position.y+this.height&&r.position.x+r.width+20>=this.position.x&&r.position.x-20<=this.position.x+this.width?(p.ismute||(e.gemSound&&(e.gemSound.pause(),e.gemSound.currentTime=0),e.gemSound.play()),r.gemCount+=this.value,r.essenceCount<u.maxEssence&&(r.essenceCount+=1),!1):!0}}function _(i,n,o,s,a,l,g="",S="2rem ShadowOfTheDead",T="#4caf50"){i.font=S,i.fillStyle=T,i.fillText(g,n.x,n.y-l/5);const b=Math.floor(o/s*a);i.strokeStyle="black",i.strokeRect(n.x,n.y,a,l),i.fillStyle="rgba(200,200,200,0.5)",i.fillRect(n.x,n.y,a,l),i.fillStyle="rgba(76, 175, 80,0.5)",i.fillRect(n.x,n.y,b,l)}const B={width:226,height:148,positionLeft:[new t(1,21),new t(234,21),new t(456,21),new t(700,21),new t(936,21),new t(1169,21),new t(1396,21),new t(1622,21),new t(1850,21),new t(2077,21),new t(2304,21),new t(2531,21),new t(2758,21),new t(2985,21),new t(3212,21),new t(3439,21),new t(3665,21),new t(3892,21),new t(4119,21),new t(4346,21),new t(4572,21),new t(4800,21),new t(5027,21),new t(5253,21),new t(5481,21),new t(5708,21),new t(5936,21),new t(6163,21),new t(6391,21),new t(6619,21),new t(6846,21),new t(7074,21),new t(7301,21),new t(7529,21),new t(7983,21),new t(8210,21),new t(8437,21),new t(8665,21)],positionRight:[new t(1,21),new t(229,21),new t(458,21),new t(686,21),new t(914,21),new t(1143,21),new t(1370,21),new t(1598,21),new t(1827,21),new t(2056,21),new t(2284,21),new t(2512,21),new t(2740,21),new t(2968,21),new t(3195,21),new t(3422,21),new t(3651,21),new t(3878,21),new t(4107,21),new t(4334,21),new t(4562,21),new t(4790,21),new t(5018,21),new t(5246,21),new t(5475,21),new t(5703,21),new t(5932,21),new t(6160,21),new t(6388,21),new t(6616,21),new t(6843,21),new t(7071,21),new t(7300,21),new t(7755,21),new t(7982,21),new t(8209,21),new t(8437,21),new t(8665,21)]};class Xt extends ii{constructor(){super(...arguments);d(this,"speedToggle",!1);d(this,"attackInterval",null);d(this,"spitInterval",null)}changeSpeed(){this.spitTohero(),this.spitInterval=setInterval(()=>{this.velocity=this.speedToggle?c.boss.velocity:c.boss.velocityFast,this.speedToggle=!this.speedToggle},5e3)}checkCollision(){return r.position.y+r.height/2>=this.position.y&&r.position.y<=this.position.y+this.height&&r.position.x+r.width>=this.position.x&&r.position.x+r.width<=this.position.x+r.width+this.width}update(){this.checkCollision()?this.attackInterval||(this.attackInterval=setInterval(()=>{r.healthpoint>0&&(r.healthpoint-=this.damage)},1e3/this.attackRate)):(this.moveTowardsHero(),clearInterval(this.attackInterval),this.attackInterval=null)}spitTohero(){this.spitInterval||(this.spitInterval=setInterval(()=>{if(r){const o=new t(r.position.x,r.position.y),s=this.position.pointDifference(o),a=this.position.distanceBetween(o),l=new t(s.x/a,s.y/a),g=new et(new t(this.position.x+this.width/2,this.position.y+this.width/2),this.damage,new t(-l.x*M.bulletVelocity*.3,-l.y*M.bulletVelocity*.3),this.position);U.push(g)}},1e3/this.attackRate))}moveTowardsHero(){const o=this.position.pointDifference(r.position),s=this.position.distanceBetween(r.position),a=new t(-(o.x/s)*this.velocity.x,-(o.y/s)*this.velocity.y);this.position.x+=a.x,this.position.y+=a.y}draw(o){this.update(),this.lookingLeft=r.position.x<this.position.x+this.width/2;const s=this.lookingLeft?B.positionLeft:B.positionRight,a=this.lookingLeft?c.boss.imageLeft:c.boss.imageRight;let g=Math.floor(this.spritePosition/5)%s.length;this.width=B.width*c.boss.width,this.height=B.height*c.boss.height,o.drawImage(a,s[g].x,s[g].y,B.width,B.height,this.position.x,this.position.y,this.width,this.height),_(o,this.position,this.healthpoint,c.boss.healthPoint,200,5),this.spritePosition++}}const Wt="/LF-SE-Minor-Project_Dungeon-Dread/assets/pestol-2UG2JAP-.svg",Jt="/LF-SE-Minor-Project_Dungeon-Dread/assets/smg-BDN-O0iq.png",jt="/LF-SE-Minor-Project_Dungeon-Dread/assets/vandal-BC5dnWgQ.png",Qt="/LF-SE-Minor-Project_Dungeon-Dread/assets/hunter-C0NwOVTE.png",Kt="/LF-SE-Minor-Project_Dungeon-Dread/assets/pistolSound-BpmxTjxL.mp3",Zt="/LF-SE-Minor-Project_Dungeon-Dread/assets/vandalSound-C1wxq2K1.mp3",ie="/LF-SE-Minor-Project_Dungeon-Dread/assets/hunterSound-BmhEE_dh.mp3",te="/LF-SE-Minor-Project_Dungeon-Dread/assets/SMGSound-3Wzeh9yy.mp3",G={width:123,height:57,positionRight:[new t(0,0)],positionLeft:[new t(125,0)]},N={width:127,height:56,positionRight:[new t(0,0)],positionLeft:[new t(149,0)]},C={width:66,height:38,positionRight:[new t(5,31),new t(67,40),new t(19,46)],positionLeft:[new t(90,31),new t(94,40),new t(143,46)]},q={width:101,height:54,positionRight:[new t(0,0)],positionLeft:[new t(127,0)]},Bi=new Image,nt=new Image,_i=new Image,Gi=new Image;Gi.src=Wt;Bi.src=Jt;_i.src=jt;nt.src=Qt;Gi.onload=v;Bi.onload=v;_i.onload=v;const w={pistol:{damage:3,width:C.width*u.width*.01,height:C.height*u.width*.01,image:Gi,fireRate:2,cost:500,soundSrc:Kt},smg:{damage:.5,width:q.width*u.width*.01,height:q.height*u.width*.01,image:Bi,fireRate:5,cost:1500,soundSrc:te},vandal:{damage:1,width:G.width*u.width*.01,height:G.height*u.width*.01,image:_i,fireRate:7,cost:2500,soundSrc:Zt},hunter:{damage:5,width:N.width*u.width*.01,height:N.height*u.width*.01,image:nt,fireRate:7,cost:3500,soundSrc:ie}};function hi(i,n,o=new t(-(i.measureText(n).width/2+e.mapPosition.x),h.height/2-e.mapPosition.y),s="5rem ShadowOfTheDeadOver",a="#4caf50"){i.font=s,i.fillStyle=a,i.translate(o.x,o.y),i.fillText(n,h.width/2,0),i.translate(-o.x,-o.y)}const ee="/LF-SE-Minor-Project_Dungeon-Dread/assets/background-fPH3rH_v.webp",ne="/LF-SE-Minor-Project_Dungeon-Dread/assets/Controls-CzxVzJrG.png",oe="/LF-SE-Minor-Project_Dungeon-Dread/assets/story1-DyVB0wqQ.mp3",se="/LF-SE-Minor-Project_Dungeon-Dread/assets/heroIntroduction-Dad3xrGL.mp3",Ni=new Audio(oe),qi=new Audio(se);Ni.volume=.2;qi.volume=.2;const Vi=new Image,$i=new Image;$i.src=ne;Vi.src=ee;qi.onload=v;Ni.onload=v;$i.onload=v;Vi.onload=v;const x={controlImage:$i,backGroundImage:Vi,story1sound:Ni,prevSoundHolder:null,heroIntroductionSound:qi};function V(i,n,o,s="3rem Eater",a="white"){return o||console.log("no position"),i.fillStyle=a,i.font=s,i.fillText(n,o.x,o.y),i.measureText(n)}function ae(i,n,o,s,a="1rem Arial",l="white"){i.font=a,i.fillStyle=l;const g=i.measureText("sample"),S=g.actualBoundingBoxAscent+g.actualBoundingBoxDescent,T=n.split(" ").filter(F=>F.trim()!=="");let b="",R=s.y+S;const z=s.x+S;for(let F=0;F<T.length;F++){const ti=b+T[F]+" ",ei=i.measureText(ti).width;b=ti,ei>=o*.9&&(i.fillText(b,z,R),R+=S,b="")}i.fillText(b,z,R)}function $(i,n,o){i=new t(i.x+e.mapPosition.x,i.y+e.mapPosition.y);const s=o.width,a=o.actualBoundingBoxAscent+o.actualBoundingBoxDescent;return i.x>n.x&&i.x<n.x+s&&i.y>n.y-a&&i.y<n.y}let ot,di,st;function he(i,n){$(i,di,st)&&(p.infoScreenFlag=!1,x.prevSoundHolder&&(x.prevSoundHolder.pause(),x.prevSoundHolder.currentTime=0),ot(n))}function re(i,n,o,s){i.drawImage(x.backGroundImage,0,0,h.width,h.height),i.fillStyle="rgba(40,40,40,0.8)",i.fillRect(h.width*.1,h.height*.1,h.width*.8,h.height*.8),i.fillStyle="white",i.font="2rem ShadowOfTheDeadOver",i.fillText(n,h.width*.1,h.height*.1),ae(i,o,h.width*.8,new t(h.width*.1,h.height*.3),"1.5rem Arial"),di=new t(h.width*.1,h.height*.8),st=V(i,s,di,"1rem ShadowOfTheDeadOver")}function at(i,n,o,s){i.clearRect(0,0,h.width,h.height),re(i,n,o,s),requestAnimationFrame(()=>{at(i,n,o,s)})}function le(i,n,o,s,a){ot=a,p.infoScreenFlag=!0,i.translate(-e.mapPosition.x,-e.mapPosition.y),e.mapPosition=new t(0,0),at(i,n,o,s)}const Yi={about:{heading:"About",msg:`The world in Dungeon Dread has multiple dungeons 
            where zombies/monsters exist. The dungeon boss controls them. 
            Our main character is a zombie/monster hunter. 
            Initially, our character is equipped with 
            a weaker weapon. As he kills zombies and collects 
            rewards, the character can buy weapons at the end 
            of the wave. The boss appears at the final wave. 
            The game's objective is to survive each wave and defeat 
            the boss. Boss is much stronger than a regular monster/zombie. Stronger in the sense 
            of higher damage and higher health. After defeating the boss, 
            the dungeon's remaining monsters/zombies disappear and the dungeon 
            is free of monsters/zombies.`},gameOver:{heading:"Game Over",msg:`
        You failed the mission. The villagers were attacked by the monsters`},gameWin:{heading:"You Win",msg:"You defended the village"},story1:{heading:"Attack of Angler Monster",msg:` 
        Once upon a time, there was a peaceful village. But one day suddenly monsters started appearing in 
        the village. The chief was worried about the village. With his research assistant, there was a dungeon
        near the village from where monsters started appearing.so the chief requested the monster hunter to clear
        the dungeon and save the village.`},aboutHero:{heading:"Introduction to hero",msg:`
            Hero is a ninja with supernatural powers.
            He levitates weapons with telepathy power.
            The hero can use Amaterasu from the essence, 
            collected from the monster's dead body. 
            Amaterasu's cooldown is 15s and the max use duration
            of Amaterasu is 10sec depending upon the essence collected.
            Another hero's ability is to regenerate when his health point is 
            lower than 50 hp and regenerates till 50 hp.`}};function j(i,n,o,s,a=null){le(i,Yi[n].heading,Yi[n].msg,o,s),setTimeout(()=>{a&&(x.prevSoundHolder=a,a.play())},800)}function ht(i){var s;i.strokeStyle="white",i.fillStyle="rgba(40,200,40,0.1)",i.fillRect(-e.mapPosition.x+h.width*.2,-e.mapPosition.y+h.height*.8,h.width*.6,h.width*.08),i.strokeRect(-e.mapPosition.x+h.width*.2,-e.mapPosition.y+h.height*.8,h.width*.6,h.width*.08),i.font="1rem Arial";const o=10;for(let a=0;a<6;a++){if(e.weaponArray[a])switch((s=e.weaponArray[a])==null?void 0:s.level){case 1:i.fillStyle="rgba(200,200,200,0.8)";break;case 2:i.fillStyle="rgba(15,10,222,0.8)";break;case 3:i.fillStyle="rgba(255,215,0,0.8)";break}else i.fillStyle="rgba(200,200,200,1)";i.fillRect(-e.mapPosition.x+h.width*(.2+.1*a+.025),-e.mapPosition.y+h.height*(.8+.03),h.width*.05,h.width*.05),e.weaponArray[a]&&(i.drawImage(e.weaponArray[a].gunImage,-e.mapPosition.x+h.width*(.2+.1*a+.025),-e.mapPosition.y+h.height*(.8+.03),h.width*.05,h.width*.05),i.fillStyle="green",i.fillRect(-e.mapPosition.x+h.width*(.2+.1*a+.025),-e.mapPosition.y+h.height*(.8+.03),h.width*.01,h.width*.01),i.fillStyle="white",i.fillText(`${e.weaponArray[a].level}`,-e.mapPosition.x+h.width*(.2+.1*a+.025),-e.mapPosition.y+h.height*(.8+.03)+o))}}const H={1:[{width:5,height:5,position:new t(106,614)},{width:5,height:16,position:new t(114,614)},{width:10,height:30,position:new t(122,614)},{width:5,height:32,position:new t(135,614)},{width:10,height:30,position:new t(143,614)},{width:15,height:3,position:new t(160,614)},{width:19,height:5,position:new t(183,614)},{width:21,height:7,position:new t(207,614)},{width:22,height:9,position:new t(232,614)},{width:23,height:11,position:new t(256,614)},{width:24,height:13,position:new t(281,614)},{width:24,height:15,position:new t(306,614)},{width:24,height:16,position:new t(331,614)}]};let pi,rt;function de(i,n){$(i,pi,rt)&&(p.aboutScreenFlag=!1,Q(n))}function pe(i){i.drawImage(x.backGroundImage,0,0,h.width,h.height),i.fillStyle="rgba(40,40,40,0.8)",i.drawImage(x.controlImage,h.width*.1,h.height*.2,h.width*.5,h.height*.5),i.fillStyle="white",i.font="2rem ShadowOfTheDeadOver",i.fillText("Controls",h.width*.1,h.height*.1),pi=new t(h.width*.1,h.height*.8),rt=V(i,"<-- return Home",pi,"1rem ShadowOfTheDeadOver")}function lt(i){i.clearRect(0,0,h.width,h.height),pe(i),requestAnimationFrame(()=>{lt(i)})}function ge(i){p.controlScreenFlag=!0,i.translate(-e.mapPosition.x,-e.mapPosition.y),e.mapPosition=new t(0,0),lt(i)}let gi,wi,mi,ci,ui,yi,Xi=0;function we(i,n){i=new t(-e.mapPosition.x+i.x,-e.mapPosition.y+i.y),wi&&$(i,gi,wi)&&(p.homeScreenFlag=!1,e.homeSound.pause(),j(n,"story1","Continue =>",()=>{j(n,"aboutHero","Continue =>",Si,x.heroIntroductionSound),Si(n)},x.story1sound)),yi&&$(i,ui,yi)&&(p.homeScreenFlag=!1,ge(n)),ci&&$(i,mi,ci)&&(p.homeScreenFlag=!1,j(n,"about","<=return Home",Q))}function me(i){const n=Math.floor(Xi/8)%H[1].length;i.drawImage(c.type3.image,H[1][n].position.x,H[1][n].position.y,H[1][n].width,H[1][n].height,h.width*.9-24,e.mapPosition.y,H[1][n].width*h.width*.001,H[1][n].height*h.width*.001),Xi++}function ce(i){i.clearRect(-e.mapPosition.x,-e.mapPosition.y,h.width,h.height),i.drawImage(x.backGroundImage,-e.mapPosition.x,-e.mapPosition.y,h.width,h.height),i.fillStyle="rgba(40,40,40,0.1)",i.fillRect(-e.mapPosition.x,-e.mapPosition.y,h.width,h.height),gi=new t(-e.mapPosition.x+h.width*.01,-e.mapPosition.y+h.height*.4),ui=new t(-e.mapPosition.x+h.width*.01,-e.mapPosition.y+h.height*.5),mi=new t(-e.mapPosition.x+h.width*.01,-e.mapPosition.y+h.height*.6);const n="DUNGEON DREAD";i.font="4rem ShadowOfTheDeadOver",i.fillStyle="white";const o=i.measureText(n);i.fillText(n,-e.mapPosition.x+h.width*.01,-e.mapPosition.y+h.height*.01+o.actualBoundingBoxAscent+o.actualBoundingBoxDescent),wi=V(i,"PLAY",gi,"4rem bold Eater ","red"),ci=V(i,"ABOUT",mi),yi=V(i,"INSTRUCTIONS",ui),me(i)}function dt(i){i.clearRect(0,0,h.width,h.height),ce(i),p.homeScreenFlag&&requestAnimationFrame(()=>{dt(i)})}function Q(i){p.homeScreenFlag=!0,p.ismute||(e.homeSound&&(e.homeSound.pause(),e.homeSound.currentTime=0),e.homeSound.play()),dt(i)}let pt,k=[],K=[],Z=[],U=[],r,y,fi;function Wi(){return new Date().getTime()-pt.getTime()}const ue=new Ht(m.tileSize);function gt(){r=new Ct(new t(window.innerWidth/2,window.innerHeight/2),"blue",!0,e.heroTotalHealth,u.width,u.height),r.reheal()}function ye(){Z=Z.filter(i=>i.collected())}function fe(){k=k.filter(i=>{if(i.healthpoint<0)clearInterval(i.attackInterval),i.attackInterval=null,Z.push(new Yt(i.position,16,f[1][0].width*.2,f[1][0].height*.2));else return!0})}function Se(){K=K.filter(i=>(i.checkOnhit(k,y),!(i.endPoint.x>=window.innerHeight*m.mapSizeMultiplier||i.startPoint.x<=0||i.isHit))),U=U.filter(i=>(i.checkOnhit(),!(i.position.x>=window.innerHeight*m.mapSizeMultiplier||i.position.x<=0||i.isHit)))}function ve(){fi=setInterval(()=>{if(k.length<e.maxEnemies){const i=E(1,100);p.wave>2&&i<40&&k.push(new Ut(new t(E(m.tileSize+m.displayPosition.x,window.innerWidth*5-m.tileSize),E(m.tileSize+m.displayPosition.y,window.innerHeight*5-m.tileSize*2)),"red",!0,c.type2.healthPoint,c.type2.width,c.type2.height,c.type2.damage,c.type2.attackRate,c.type2.image,2,c.type2.velocity)),p.wave>3&&i<50?k.push(new Vt(new t(E(m.tileSize+m.displayPosition.x,window.innerWidth*5-m.tileSize),E(m.tileSize+m.displayPosition.y,window.innerHeight*5-m.tileSize*2)),"red",!0,c.type4.healthPoint,c.type4.width,c.type4.height,c.type4.damage,c.type4.attackRate,c.type4.image,4,c.type4.velocity)):p.wave>1&&i<60?k.push(new Ui(new t(E(m.tileSize+m.displayPosition.x,window.innerWidth*5-m.tileSize),E(m.tileSize+m.displayPosition.y,window.innerHeight*5-m.tileSize*2)),"red",!0,c.type3.healthPoint,c.type3.width,c.type3.height,c.type3.damage,c.type3.attackRate,c.type3.image,3,c.type3.velocity)):k.push(new Ui(new t(E(m.tileSize+m.displayPosition.x,window.innerWidth*5-m.tileSize),E(m.tileSize+m.displayPosition.y,window.innerHeight*5-m.tileSize*2)),"red",!0,c.type1.healthPoint,c.type1.width,c.type1.height,c.type1.damage,c.type1.attackRate,c.type1.image,1,c.type1.velocity))}},500)}function Ji(){p.ingame=!1,clearInterval(r.abilityInterval),r.abilityInterval=null,e.weaponArray=[],p.wave=1,k.forEach(i=>{i&&(clearInterval(i.attackInterval),i.attackInterval=null)}),e.weaponArray.forEach(i=>{i&&(clearInterval(i.fireInterval),i.fireInterval=null,i.detectedEnemy=!1,i.trackingEnemyObj=null)}),y&&(clearInterval(y.attackInterval),y.attackInterval=null,clearInterval(y.spitInterval),y.spitInterval=null),y=null,gt()}function Pe(i){i.drawImage(m.mapImage,m.displayPosition.x,m.displayPosition.y,window.innerWidth*m.mapSizeMultiplier,window.innerHeight*m.mapSizeMultiplier),ue.draw(i),k.forEach(g=>{g.isSpwaned?g.draw(i):g.spwan(i)}),y&&(y.draw(i),e.maxEnemies=50,e.weaponArray.forEach(g=>{y&&g&&g.detectEnemy(y)}),y.healthpoint<=0&&(ri(),Ji(),j(i,"gameWin","<= return Home",Q))),r.draw(i),e.dropdownInterval&&hi(i,`wave : ${p.wave}`);const n=i.createRadialGradient(r.position.x+r.width/2,r.position.y+r.height/2,r.width,r.position.x+r.width/2,r.position.y+r.height/2,1e3);r.healthpoint>30?(n.addColorStop(0,"rgba(10,10,10,0)"),n.addColorStop(1,"rgba(0,0,0,0.99)")):(n.addColorStop(0,"rgba(10,10,10,0)"),n.addColorStop(1,"rgba(200,0,0,0.99)")),i.fillStyle=n,i.fillRect(-e.mapPosition.x,-e.mapPosition.y,h.width,h.height),_(i,new t(h.width*.05-e.mapPosition.x,h.height*.1-e.mapPosition.y),r.healthpoint,e.heroTotalHealth,h.width*.45,h.height*.03,"Life line");const o=`x ${r.gemCount}`;i.drawImage(e.gemImage,f[1][0].position.x,f[1][0].position.y,f[1][0].width,f[1][0].height,h.width*.05-e.mapPosition.x,h.height/5-e.mapPosition.y,f[1][0].width*.3,f[1][0].height*.3),i.font="1rem Eater",i.fillStyle="white";const s=i.measureText(o),a=s.actualBoundingBoxAscent+s.actualBoundingBoxDescent;i.fillText(o,h.width*.05-e.mapPosition.x+f[1][0].width*.5,h.height/5-e.mapPosition.y+a*1.5),i.drawImage(u.sharingan,h.width*.05-e.mapPosition.x,h.height/5-e.mapPosition.y+f[1][0].height*.5,f[1][0].width*.4,f[1][0].height*.4);const l=(new Date().getTime()-r.abilityTime.getTime())/(15*1e3);if(l<1&&!r.abilityInUse?(i.beginPath(),i.fillStyle="rgba(240,240,240,0.6)",i.arc(h.width*.05-e.mapPosition.x+f[1][0].width*.2,h.height/5-e.mapPosition.y+f[1][0].height*.5+f[1][0].height*.2,f[1][0].width*.2,0,2*Math.PI*(1-l)),i.fill()):(i.beginPath(),i.strokeStyle="blue",i.fillStyle="rgba(240,240,240,0.6)",i.arc(h.width*.05-e.mapPosition.x+f[1][0].width*.2,h.height/5-e.mapPosition.y+f[1][0].height*.5+f[1][0].height*.2,f[1][0].width*.2,0,2*Math.PI),i.stroke()),r.staminaUse&&_(i,new t(h.width*.05-e.mapPosition.x,h.height/5-e.mapPosition.y+f[1][0].height*1.5),r.stamina,u.stamina,h.width*.1,h.height*.02,"Stamina","1rem Arial"),_(i,new t(h.width*.95-h.width*.4-e.mapPosition.x,h.height*.1-e.mapPosition.y),r.essenceCount,u.maxEssence,h.width*.4,h.height*.03,"Essence"),Wi()>=e.waveIntervalTime&&r.healthpoint>0&&!y&&(p.wave++,e.weaponArray.forEach(g=>{g&&(clearInterval(g.fireInterval),g.fireInterval=null)}),ri(),xe(i)),y)hi(i,"Final Wave",new t(-(i.measureText("Final Wave").width/2+e.mapPosition.x),h.height/5-e.mapPosition.y),"0.1rem");else{const g=`${Math.floor((e.waveIntervalTime-Wi())/1e3)}`;hi(i,`${g}`,new t(-(i.measureText(g).width/2+e.mapPosition.x),h.height/5-e.mapPosition.y),"0.1rem")}r.healthpoint<=0&&(ri(),Ji(),j(i,"gameOver","<= return Home",Q)),K.forEach(g=>{g.draw(i)}),U.forEach(g=>{g.draw(i)}),Z.forEach(g=>{g.draw(i)}),e.weaponArray.forEach((g,S)=>{g&&(g.draw(i),g.position=r.weaponPositions[S])}),e.maxEnemies=500,ht(i)}function wt(i){i==null||i.clearRect(-e.mapPosition.x,-e.mapPosition.y,h.width,h.height),Re(),Pe(i),fe(),Se(),ye(),k.forEach(n=>{e.weaponArray.forEach(o=>{o&&o.detectEnemy(n)})}),p.ingame&&requestAnimationFrame(()=>{wt(i)})}function ri(){e.windSound.pause(),e.windSound.currentTime=0,k.forEach(i=>{clearInterval(i.attackInterval),i.attackInterval=null}),y&&(clearInterval(y.attackInterval),clearInterval(y.spitInterval),y.attackInterval=null,y.spitInterval=null),r.healthpoint=e.heroTotalHealth,K=[],k=[],U=[],Z=[],clearInterval(fi),fi=null,pt=new Date,e.weaponArray[0]||(e.weaponArray[0]=new X(r.weaponPositions[0],!1,w.pistol.damage,w.pistol.width,w.pistol.height,w.pistol.fireRate,w.pistol.cost,w.pistol.image,"pistol",new Audio(w.pistol.soundSrc))),e.weaponArray.forEach((i,n)=>{i&&(clearInterval(i.fireInterval),i.fireInterval=null,i.trackingEnemyObj=null,i.detectedEnemy=!1,i.position=r.weaponPositions[n])})}function Si(i){p.infoScreenFlag||(p.ingame=!0,r||gt(),ri(),ve(),e.dropdownInterval=!0,setTimeout(()=>{e.dropdownInterval=!1},5e3),e.dropdownInterval&&hi(i,`wave : ${p.wave}`),y&&(clearInterval(y.attackInterval),y.attackInterval=null,clearInterval(y.spitInterval),y.spitInterval=null),y=null,p.wave>=5&&(y=new Xt(new t(E(m.tileSize+m.displayPosition.x,window.innerWidth*5-m.tileSize),E(m.tileSize+m.displayPosition.y,window.innerHeight*5-m.tileSize*2)),"red",!0,c.boss.healthPoint,c.boss.width,c.boss.height,c.boss.damage,c.boss.attackRate,c.boss.image,2,c.boss.velocity),e.maxEnemies=50,y.changeSpeed()),p.ismute||(e.windSound&&(e.windSound.pause(),e.windSound.currentTime=0),e.windSound.play()),e.weaponArray.forEach(n=>{n&&(clearInterval(n.fireInterval),n.fireInterval=null,n.detectedEnemy=!1,n.trackingEnemyObj=null)}),wt(i))}class Ie{constructor(n,o,s,a,l){d(this,"startPoint");d(this,"endPoint");d(this,"damage");d(this,"isHit",!1);d(this,"velocity");d(this,"gunPosition");this.startPoint=n,this.endPoint=o,this.damage=s,this.velocity=a,this.gunPosition=l}checkOnhit(n,o=null){n.forEach(s=>{this.endPoint.x>s.position.x&&this.endPoint.x<s.position.x+s.width&&this.endPoint.y>s.position.y&&this.endPoint.y<s.position.y+s.height&&(this.isHit=!0,s.healthpoint-=this.damage)}),o&&this.endPoint.x>o.position.x&&this.endPoint.x<o.position.x+o.width&&this.endPoint.y>o.position.y&&this.endPoint.y<o.position.y+o.height&&(this.isHit=!0,o.healthpoint-=this.damage)}draw(n){this.startPoint=this.startPoint.add(this.velocity),this.endPoint=this.endPoint.add(this.velocity),n.beginPath(),n.strokeStyle="gold",n.moveTo(this.startPoint.x,this.startPoint.y),n.lineTo(this.endPoint.x,this.endPoint.y),n.lineWidth=3,n.stroke()}}class X{constructor(n,o,s,a,l,g=1,S=500,T,b,R){d(this,"position");d(this,"lookingLeft");d(this,"damage");d(this,"width");d(this,"height");d(this,"spritePosition",0);d(this,"fireRate");d(this,"cost");d(this,"gunImage");d(this,"guntype");d(this,"detectedEnemy",!1);d(this,"trackingEnemyObj",null);d(this,"lookingAngle",0);d(this,"shootingPoint",C.positionRight[1]);d(this,"fireInterval",null);d(this,"level",1);d(this,"sound");this.position=n,this.lookingLeft=o,this.damage=s,this.width=a,this.height=l,this.gunImage=T,this.fireRate=g,this.cost=S,this.guntype=b,this.sound=R}playSound(){p.ismute||(this.sound.volume=.2,this.sound&&(this.sound.pause(),this.sound.currentTime=0),this.sound.play())}detectEnemy(n){const o=this.position;o.distanceBetween(n.position)<M.pestol&&!this.detectedEnemy&&(this.detectedEnemy=!0,this.trackingEnemyObj=n),this.detectedEnemy&&this.trackingEnemyObj&&(this.lookingAngle=o.angle(new t(this.trackingEnemyObj.position.x,this.trackingEnemyObj.position.y)),this.shoot(),this.position.distanceBetween(this.trackingEnemyObj.position)>M.pestol&&(this.detectedEnemy=!1,clearInterval(this.fireInterval),this.fireInterval=null)),this.trackingEnemyObj&&this.trackingEnemyObj.healthpoint<0&&(this.detectedEnemy=!1,clearInterval(this.fireInterval),this.fireInterval=null)}shoot(){this.lookingLeft?this.shootingPoint=new t(this.position.x,this.position.y+this.height/4):this.shootingPoint=new t(this.position.x+this.width,this.position.y+this.height/4),this.trackingEnemyObj&&this.position.x>this.trackingEnemyObj.position.x&&(this.shootingPoint.x=this.position.x),this.shootingPoint.x=this.position.x+(this.shootingPoint.x-this.position.x)*Math.cos(this.lookingAngle)-(this.shootingPoint.y-this.position.y)*Math.sin(this.lookingAngle),this.shootingPoint.y=this.position.y+(this.shootingPoint.x-this.position.x)*Math.sin(this.lookingAngle)+(this.shootingPoint.y-this.position.y)*Math.cos(this.lookingAngle),this.fireInterval||(this.fireInterval=setInterval(()=>{if(this.trackingEnemyObj){const n=new t(this.trackingEnemyObj.position.x+this.trackingEnemyObj.width/2,this.trackingEnemyObj.position.y+this.trackingEnemyObj.height/2),o=this.shootingPoint.pointDifference(n),s=this.shootingPoint.distanceBetween(n),a=new t(o.x/s,o.y/s),l=new t(this.shootingPoint.x+a.x*10,this.shootingPoint.y+a.y*10),g=new Ie(this.shootingPoint,l,this.damage,new t(-a.x*M.bulletVelocity,-a.y*M.bulletVelocity),this.position);K.push(g),this.playSound()}},1e3/this.fireRate))}draw(n){let o;switch(this.guntype){case"pistol":o=C;break;case"smg":o=q;break;case"vandal":o=G;break;case"hunter":o=N;break}n.translate(this.position.x,this.position.y),n.rotate(this.lookingAngle);let s;this.lookingLeft?(s=o.positionLeft[0],this.shootingPoint=new t(0,this.height/4)):(s=o.positionRight[0],this.shootingPoint=new t(this.width,this.height/4)),this.trackingEnemyObj&&this.position.x>this.trackingEnemyObj.position.x&&(s=s===o.positionLeft[0]?o.positionRight[0]:o.positionLeft[0],this.shootingPoint.x=0),n.fillStyle="red",n.drawImage(this.gunImage,s.x,s.y,o.width,o.height,0,0,this.width,this.height),n.rotate(-this.lookingAngle),n.translate(-this.position.x,-this.position.y)}}let mt,P=0;function ji(){return new Date().getTime()-mt.getTime()}function Qi(i,n,o){const s=o.x,a=o.y;return i=new t(i.x-e.mapPosition.x,i.y-e.mapPosition.y),i.x>n.x&&i.x<n.x+s&&i.y>n.y&&i.y<n.y+a}let ke=i=>{for(let a=0;a<6;a++)if(Qi(i,new t(-e.mapPosition.x+h.width*(.2+.1*a+.025),-e.mapPosition.y+h.height*.8300000000000001),new t(h.width*.05,h.width*.05))){P=a;break}const n=h.width*.8-e.mapPosition.x,o=h.height*.5-e.mapPosition.y,s=new t(h.width*.1-e.mapPosition.x,h.height*.1-e.mapPosition.y);for(let a=0;a<4;a++)if(Qi(i,new t(s.x+n*a/4,s.y),new t(n/4,o))){switch(a){case 0:r.gemCount>=w.pistol.cost&&(e.weaponArray[P]=new X(r.weaponPositions[P],!1,w.pistol.damage,w.pistol.width,w.pistol.height,w.pistol.fireRate,w.pistol.cost,w.pistol.image,"pistol",new Audio(w.pistol.soundSrc)),r.gemCount-=w.pistol.cost);break;case 1:r.gemCount>=w.smg.cost&&(e.weaponArray[P]=new X(r.weaponPositions[P],!1,w.smg.damage,w.smg.width,w.smg.height,w.smg.fireRate,w.smg.cost,w.smg.image,"smg",new Audio(w.smg.soundSrc)),r.gemCount-=w.smg.cost);break;case 2:r.gemCount>=w.vandal.cost&&(e.weaponArray[P]=new X(r.weaponPositions[P],!1,w.vandal.damage,w.vandal.width,w.vandal.height,w.vandal.fireRate,w.vandal.cost,w.vandal.image,"vandal",new Audio(w.vandal.soundSrc)),r.gemCount-=w.vandal.cost);break;case 3:r.gemCount>=w.hunter.cost&&(e.weaponArray[P]=new X(r.weaponPositions[P],!1,w.hunter.damage,w.hunter.width,w.hunter.height,w.hunter.fireRate,w.hunter.cost,w.hunter.image,"hunter",new Audio(w.hunter.soundSrc)),r.gemCount-=w.hunter.cost);break}for(let g=0;g<e.weaponArray.length&&(P=g,!!e.weaponArray[g]);g++);break}};function be(){e.weaponArray[P]&&e.weaponArray[P].level<3&&r.gemCount>=e.weaponArray[P].cost*1.1?(e.weaponArray[P].damage+=e.weaponArray[P].damage*.1,e.weaponArray[P].fireRate+=e.weaponArray[P].fireRate*.1,e.weaponArray[P].level++,r.gemCount-=e.weaponArray[P].cost*.1):(e.denySound&&(e.denySound.pause(),e.denySound.currentTime=0),e.denySound.play())}function ai(i,n,o,s,a,l,g,S,T,b,R,z,F,ti){i.strokeRect(o.x+s*n/4,o.y,s/4,a),i.fillRect(o.x+s*n/4+s/8-l/2,o.y*1.3,l,l),i.drawImage(g,S.x,S.y,T,b,o.x+s*n/4+s/8-l/2,o.y*1.3,l,l),i.font="2rem Eater",i.fillStyle="white";const ei=i.measureText("sample"),ni=ei.actualBoundingBoxAscent+ei.actualBoundingBoxDescent;i.fillText(`Gun: ${R}`,o.x+s*n/4+l/2,o.y*1.3+l+ni*4),i.fillText(`Cost: ${z}`,o.x+s*n/4+l/2,o.y*1.3+l+ni*5.5),i.fillText(`Damage: ${F}`,o.x+s*n/4+l/2,o.y*1.3+l+ni*7),i.fillText(`Fire Rate: ${ti}`,o.x+s*n/4+l/2,o.y*1.3+l+ni*8.5)}function ct(i){const n=h.width*.8-e.mapPosition.x,o=h.height*.5-e.mapPosition.y,s=new t(h.width*.1-e.mapPosition.x,h.height*.1-e.mapPosition.y);let a;const l=h.width*.05;i==null||i.clearRect(-e.mapPosition.x,-e.mapPosition.y,h.width,h.height),i.fillStyle="rgba(10,10,40,0.5)",i.fillRect(s.x,s.y,n,o),i.font="3rem ShadowOfTheDeadOver",i.fillStyle="#4caf50",i.fillText("Buy Menu: ",h.width*.1-e.mapPosition.x,h.height*.1-e.mapPosition.y),i.font="2rem Eater",i.fillStyle="#4caf50",i.fillText(`Gems Count: ${r.gemCount}`,h.width*.8-e.mapPosition.x,h.height*.1-e.mapPosition.y),i.fillStyle="rgba(200,200,200,0.8)",i.strokeStyle="green",a=0,ai(i,a,s,n,o,l,w.pistol.image,C.positionRight[0],C.width,C.height,"Pistol",w.pistol.cost,w.pistol.damage,w.pistol.fireRate),a=1,ai(i,a,s,n,o,l,w.smg.image,q.positionRight[0],q.width,q.height,"SMG",w.smg.cost,w.smg.damage,w.smg.fireRate),a=2,ai(i,a,s,n,o,l,w.vandal.image,G.positionRight[0],G.width,G.height,"vandal",w.vandal.cost,w.vandal.damage,w.vandal.fireRate),a=3,ai(i,a,s,n,o,l,w.hunter.image,N.positionRight[0],N.width,N.height,"hunter",w.hunter.cost,w.hunter.damage,w.vandal.fireRate),ht(i),i.strokeStyle="gold",i.strokeRect(-e.mapPosition.x+h.width*(.2+.1*P+.025),-e.mapPosition.y+h.height*(.8+.03),h.width*.05,h.width*.05),_(i,new t(h.width*.1-e.mapPosition.x,h.height*.7-e.mapPosition.y),ji(),e.buyTime,h.width*.8,h.height*.01,"Buy Time:"),ji()>=e.buyTime&&(e.weaponArray.forEach((g,S)=>{g&&(g.position=r.weaponPositions[S])}),p.buyScreenFlag=!1,Si(i)),p.ingame||requestAnimationFrame(()=>{ct(i)})}function xe(i){i.translate(-e.mapPosition.x,-e.mapPosition.y),e.mapPosition=new t(0,0),p.ingame=!1,p.buyScreenFlag=!0,mt=new Date,P=0;for(let n=0;n<e.weaponArray.length&&(P=n,!!e.weaponArray[n]);n++);ct(i)}let vi,Pi;function Te(i,n){i=new t(-e.mapPosition.x+i.x,-e.mapPosition.y+i.y),Pi&&$(i,vi,Pi)&&(p.firstPageFlag=!1,Q(n))}function Ee(i){i.clearRect(-e.mapPosition.x,-e.mapPosition.y,h.width,h.height),i.drawImage(x.backGroundImage,-e.mapPosition.x,-e.mapPosition.y,h.width,h.height);const n="DUNGEON DREAD";i.font="3rem ShadowOfTheDeadOver",i.fillStyle="white";const o=i.measureText(n);i.fillText(n,h.width*.5-o.width/2,h.height*.3+o.actualBoundingBoxAscent+o.actualBoundingBoxDescent),i.font="3rem Eater",vi=new t(h.width*.5-i.measureText("ENTER").width/2,-e.mapPosition.y+h.height*.8),Pi=V(i,"ENTER",vi)}function ut(i){i.clearRect(0,0,h.width,h.height),Ee(i),p.homeScreenFlag&&requestAnimationFrame(()=>{ut(i)})}function De(i){p.firstPageFlag=!0,e.homeSound&&(e.homeSound.pause(),e.homeSound.currentTime=0),ut(i)}function Ae(){p.ismute=!p.ismute,p.ismute?(e.homeSound.pause(),e.homeSound.currentTime=0,e.windSound.pause(),e.windSound.currentTime=0,x.prevSoundHolder&&(x.prevSoundHolder.pause(),e.windSound.currentTime=0)):(p.homeScreenFlag&&e.homeSound.play(),p.ingame&&e.windSound.play())}function Re(){p.btnPressed.a&&p.btnPressed.w||p.btnPressed.a&&p.btnPressed.s||p.btnPressed.d&&p.btnPressed.w||p.btnPressed.d&&p.btnPressed.s?(r.velocity.x=.7*u.velocity.x,r.velocity.y=.7*u.velocity.y):p.btnPressed.c&&(p.btnPressed.w||p.btnPressed.a||p.btnPressed.s||p.btnPressed.d)?r.run():(r.velocity.x=u.velocity.x,r.velocity.y=u.velocity.y),p.btnPressed.a&&(r.isMoving=!0,r.moveLeft(!0,O)),p.btnPressed.d&&(r.isMoving=!0,r.moveLeft(!1,O)),p.btnPressed.w&&(r.moveUp(!0,O),r.isMoving=!0),p.btnPressed.s&&(r.moveUp(!1,O),r.isMoving=!0),p.btnPressed[" "]&&r.ability()}function Oe(){window.addEventListener("keydown",i=>{p.btnPressed[i.key.toLowerCase()]=!0,p.buyScreenFlag&&p.btnPressed.u&&be(),i.key.toLowerCase()==="m"&&Ae()}),window.addEventListener("keyup",i=>{p.btnPressed[i.key.toLowerCase()]=!1,r.isMoving=!1}),window.addEventListener("click",i=>{p.firstPageFlag&&Te(new t(i.offsetX,i.offsetY),O),p.homeScreenFlag&&we(new t(i.offsetX,i.offsetY),O),p.buyScreenFlag&&ke(new t(i.offsetX,i.offsetY)),p.infoScreenFlag&&he(new t(i.offsetX,i.offsetY),O),p.controlScreenFlag&&de(new t(i.offsetX,i.offsetY),O)})}function Le(i){i.clearRect(-e.mapPosition.x,-e.mapPosition.y,h.width,h.height),i.fillStyle="rgba(40,40,240,1)",i.fillRect(-e.mapPosition.x,-e.mapPosition.y,h.width,h.height),i.fillStyle="rgba(40,40,40,0.1)",i.fillRect(-e.mapPosition.x,-e.mapPosition.y,h.width,h.height);const n="DUNGEON DREAD";i.font="3rem ShadowOfTheDeadOver",i.fillStyle="white";const o=i.measureText(n);i.fillText(n,-e.mapPosition.x+h.width*.01,-e.mapPosition.y+h.height*.01+o.actualBoundingBoxAscent+o.actualBoundingBoxDescent),_(i,new t(h.width*.3,h.height*.5),p.assetsLoaded,18,h.width*.4,10,"Loading... ","4rem Arial","white"),p.assetsLoaded>=16&&(p.loadingScreen=!1,De(i))}function yt(i){i.clearRect(0,0,h.width,h.height),Le(i),p.loadingScreen&&requestAnimationFrame(()=>{yt(i)})}function Me(i){p.loadingScreen=!0,p.ismute||(e.homeSound&&(e.homeSound.pause(),e.homeSound.currentTime=0),e.homeSound.play()),yt(i)}const h=document.getElementById("canvas"),O=h.getContext("2d");Oe();h&&(h.width=window.innerWidth,h.height=window.innerHeight,h.style.background="linear-gradient(172.33deg, #30303A -1.75%, #20202E 83.53%, #050519 104.9%)",Me(O));
